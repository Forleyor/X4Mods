<?xml version="1.0" encoding="utf-8"?>
<diff>
  <!-- <add sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedclasses? and $StationSpecs.$containedclasses.count']/do_for_each/do_elseif[@value='$class.{2} == class.dockarea']/get_module_definition[@macro='$ViableDefs']" type="@faction">$Faction</add>
  <add sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedclasses? and $StationSpecs.$containedclasses.count']/do_for_each/do_elseif[@value='$class.{2} == class.pier']/get_module_definition[@macro='$ViableDefs']" type="@faction">$Faction</add>
  <add sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$EquipmentCount']/get_module_definition[@macro='$ViableDefs']" type="@faction">$Faction</add>
  <add sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$products? and $StationSpecs.$products.count']/do_for_each/get_module_definition[@macro='$ViableDefs']" type="@faction">$Faction</add>
  <add sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$DefenceStation']/get_module_definition[@macro='$ViableDefs']" type="@faction">$Faction</add>
  <add sel="/mdscript/cues/library[@name='GetMostExpensiveStoragePriceCr']/actions/get_module_definition[@macro='$ViableDefs']" type="@faction">$Faction</add>

  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='BriefingStarted']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Briefing started'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='BriefingStarted']/cues/cue[@name='HoloMap_Trigger']/cues/cue[@name='HolomapEnd']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Holomap animation end'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='BriefingStarted']/cues/cue[@name='BriefingStopped']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Briefing canceled'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Mission accepted!'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Trigger']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Signalling ClaimPlot cue: ' + ClaimPlot" filter="savegame" chance="if @$Patch_InstanceRunning then 100 else 0"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Done']/cues/cue[@name='MissionEnded']/actions/do_elseif/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'This mission has failed. RML Feedback: ' + MissionEnded.$EndFeedbackValue" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Done']/cues/cue[@name='MissionEnded']/actions/do_else/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'This mission has ended. RML Feedback: ' + MissionEnded.$EndFeedbackValue" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Done']/cues/cue[@name='MissionEnded']/actions/do_else/do_if[@value='$RewardNotoriety and $ClientOwner']/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Relation was: ' + player.entity.relationto.{$ClientOwner}" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Done']/cues/cue[@name='MissionEnded']/actions/do_else/do_if[@value='$RewardNotoriety and $ClientOwner']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Relation is now: ' + player.entity.relationto.{$ClientOwner}" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Done']/cues/cue[@name='MissionEnded']/actions/do_else/do_if[@value='$RewardCapCr?']/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'$RewardCapCr: ' + $RewardCapCr.formatted.default + ', $PaidBuildPlotCr: ' + $PaidBuildPlotCr.formatted.default + ', $StationValueCr: ' + $StationValueCr.formatted.default" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Done']/cues/cue[@name='MissionEnded']/actions/do_else/do_if[@value='$RewardCapCr?']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Total reward: ' + $RewardCr" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='ReachedLocation']/cues/cue[@name='ClaimPlot_Done']/cues/cue[@name='MissionEnded']/actions/do_else/do_if[@value='$RewardCapCr?']/do_if/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Reward capped to: ' + $RewardCapCr.formatted.default" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='CleanUp']/actions/do_if[@value='$DebugChance or $ReportSignalCue']/do_if[@value='$FeedbackData']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Mission ended with reason: ' + $FeedbackData.$type + ' - ' + $FeedbackData.$text" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'RewardPlot:' + $StationPlotCr + ' for ' + $PlotSizeKm3 + 'km^3'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Builder costs ' + $BuilderCr" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedmacros? and $StationSpecs.$containedmacros.count']/do_for_each/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Macro ' + $macro.{2}.knownname + ' costs ' + $DefPrice" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedmacros? and $StationSpecs.$containedmacros.count']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Specifically requested macros cost ' + $MacroCr + ' in total.'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedclasses? and $StationSpecs.$containedclasses.count']/do_for_each/do_elseif[@value='$class.{2} == class.dockarea']/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Viable dock modules: ' + $ViableDefs" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedclasses? and $StationSpecs.$containedclasses.count']/do_for_each/do_elseif[@value='$class.{2} == class.dockarea']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="$class.{1} + ' ' + $MostExpensiveDef.{1} +  ' cost ' + $DockModuleCr + ' in total.'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedclasses? and $StationSpecs.$containedclasses.count']/do_for_each/do_elseif[@value='$class.{2} == class.pier']/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Viable pier modules: ' + $ViableDefs" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedclasses? and $StationSpecs.$containedclasses.count']/do_for_each/do_elseif[@value='$class.{2} == class.pier']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="$class.{1} + ' ' + $MostExpensiveDef.{1} +  ' cost ' + $PierModuleCr + ' in total.'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containedclasses? and $StationSpecs.$containedclasses.count']/do_for_each/do_elseif[@value='[class.turret, class.missileturret, class.shieldgenerator].indexof.{$class.{2}}']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Added ' + $class.{1} + 'x ' + $class.{2} + '. Equipment count: ' + $EquipmentCount" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$EquipmentCount']/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Viable defence modules for equipment cost calculation: ' + $ViableDefs" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$EquipmentCount']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Mission asks for ' + $EquipmentCount + ' pieces of equipment and ' + $DefenceModuleCount + ' defence modules.                                 \nA defence module holds ' + $MostExpensiveLoadout.{1}.wares.count + ' pieces of equipment each.                                 \nA full loadout costs ' + $MaxLoadoutCr + ' and the defence module itself costs ' + $MostExpensiveDef.{2} + '.                                 \n' + $FinalDefenceModuleCount + ' fully equipped ' + $MostExpensiveDef.{1} +  ' cost ' + $DefenceModuleCr + ' in total.'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$products? and $StationSpecs.$products.count']/do_for_each/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Viable production modules for ' + $product.{2} + ': ' + $ViableDefs" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$products? and $StationSpecs.$products.count']/do_for_each/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="$product.{1} + ' ' + $MostExpensiveDef +  ' cost ' + $ProductionModuleCr + ' in total.'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$solidstorage? and (typeof $StationSpecs.$solidstorage).isnumeric and $StationSpecs.$solidstorage gt 0']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Solid storage costs ' + $SolidStorageModuleSetup.{1} + ' in total. Selected modules: ' + $SolidStorageModuleSetup.{2}" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$liquidstorage? and (typeof $StationSpecs.$liquidstorage).isnumeric and $StationSpecs.$liquidstorage gt 0']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Liquid storage costs ' + $LiquidStorageModuleSetup.{1} + ' in total. Selected modules: ' + $LiquidStorageModuleSetup.{2}" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$StationSpecs.$containerstorage? and (typeof $StationSpecs.$containerstorage).isnumeric and $StationSpecs.$containerstorage gt 0']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Container storage costs ' + $ContainerStorageModuleSetup.{2} + ' in total. Selected modules: ' + $ContainerStorageModuleSetup.{1}" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$DefenceStation']/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Viable ownership claiming modules: ' + $ViableDefs" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/do_if[@value='$DefenceStation']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Ownership claiming module (' + $MostExpensiveDef.{1} + ') costs ' + $MostExpensiveDef.{2}" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CalculateResourceCostCr']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Total worst case station construction cost: ' + $ResourceCost" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='GetMostExpensiveDefinition']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'GetMostExpensiveDefinition called with ViableDefs ' + $ViableDefs" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='GetDefPriceCr']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'GetDefPriceCr called with Def ' + $Def" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='GetMostExpensiveStoragePriceCr']/actions/debug_text[@chance='$DebugChance'][1]">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'GetMostExpensiveStoragePriceCr called with StorageTag ' + $StorageTag + ' and $StorageAmount ' + $StorageAmount" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='GetMostExpensiveStoragePriceCr']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Viable storage modules, one per amount: ' + $ViableDefs" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Setup_BuildMilitary']/actions/do_if/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Selected ' + $TargetSector + ' ' + $TargetSector.knownname + ' to be the sector to build the station in'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Setup_BuildFactory']/actions/do_if/do_if[@value='$InsufficientWares.count']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'$InsufficientWares: %s'.[$InsufficientWares]" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Setup_BuildFactory']/actions/do_if/do_if[@value='$InsufficientWares.count']/do_for_each/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'%s, $IsOkToOffer: %s'.[$InsufficientWare, $IsOkToOffer]" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Setup_BuildFactory']/actions/do_if/do_if[@value='$InsufficientWares.count']/do_for_each/do_if/do_if[@value='$DebugChance == 100']/do_for_each/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'%s: %s'.[$Prop_inTable, $Value_inTable]"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Setup_BuildFactory']/actions/do_if/do_if[@value='@$IsOkToOffer']/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Selected ' + $TargetSector + ' ' + $TargetSector.knownname + ' to be the sector to build the station in'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/cue[@name='GenerateGenericMission']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Attempting to generate a generic mission'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/cue[@name='GenerateGenericMission']/patch/do_else/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'cancelling dead GM instance'" filter="savegame"/>
  </replace>
  <replace sel="/mdscript/cues/cue[@name='GenerateGenericMission']/cues/cue[@name='GenerateGenericMission_SelectVariant']/actions/do_if[@value='$PotentialOfferStations.count']/do_if/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'Checking if requested ' + $MissionVariant + ' can be spawned'" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='RegisterMission']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'%s, %s: '.[player.age, $Mission]" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='GetIsOkToOfferMission']/actions/do_if/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'$Ware: %s, $IsOk: %s, $Time_Elapsed: %s'.[$Ware, $IsOk, $Time_Elapsed]" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='GetMissionOffersInSector']/actions/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'%s'.[$MissionOffers]" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CleanMissionRegistry']/actions/do_if[@value='@$Sectors.count']/do_for_each/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'mission wares for %s in %s: %s'.[$Faction, $Sector.knownname, @md.GM_BuildStation.MissionsRegistry.$Missions.{$Faction}.{$Sector}.keys.list]" chance="100"/>
  </replace>
  <replace sel="/mdscript/cues/library[@name='CleanMissionRegistry']/actions/do_if[@value='@$Sectors.count']/do_for_each/do_if/debug_text">
    <debug_to_file name="'md_build_helper'" directory="'sw_debug'" output="false" append="true" text="'mission wares for %s in %s (post-clean): %s'.[$Faction, $Sector.knownname, @md.GM_BuildStation.MissionsRegistry.$Missions.{$Faction}.{$Sector}.keys.list]" chance="100"/>
  </replace> -->
      
	<replace  sel="//library[@name='Start']/params/param[@name='OfferDistance']/@default">350km</replace>

  <!-- <replace sel="//library[@name='Setup_BuildMilitary']/actions/do_if[@value='$TargetSector']/do_any" type="@default">
    <do_any>
      <set_value name="$StationSpecs" exact="table[
            $containedclasses = [
                [[2,3,4].random, class.defencemodule,   {30120,101}, {30120,102}],
                [[    1].random, class.dockarea,        {30120,103}, {30120,104}], 
                [[ 8,16].random, class.turret,          {30120,105}, {30120,106}],
                [[ 5,10].random, class.shieldgenerator, {30120,109}, {30120,110}],
            ],
          ]" />
      <set_value name="$StationSpecs" exact="table[
            $containedclasses = [
                [[  3,4].random, class.defencemodule,   {30120,101}, {30120,102}],
                [[    1].random, class.dockarea,        {30120,103}, {30120,104}], 
                [[20,30].random, class.turret,          {30120,105}, {30120,106}],
                [[ 6,12].random, class.shieldgenerator, {30120,109}, {30120,110}],
            ],
          ]" />
    </do_any>
  </replace> -->
<!-- kuertee mod: RAP -->
<!--
    <library name="GenerateTextTable">
        <actions>
-->
    <add pos="prepend" sel="//library[@name=&quot;GenerateTextTable&quot;]/actions">
        <include_actions ref="md.kuertee_professions_guilds.GuildMissionContainer_Description" />
    </add>
<!-- ADD:
    <library name="Start">
        <params>
-->
    <add sel="//library[@name=&quot;Start&quot;]/params">
        <param name="MissionGroup" default="null" />
    </add>
<!-- ADD property group:
    <create_offer cue="$MissionCue" ... >
-->
    <add sel="//create_offer[@cue=&quot;$MissionCue&quot;]" type="@group">$MissionGroup</add>
<!--
    <signal_cue_instantly cue="md.GenericMissions.GenericAcceptLogbookEntry" param="[$TextTable.$missionname, $Client, $ClientOwner]"/>
-->
    <add pos="after" sel="//signal_cue_instantly[@cue=&quot;md.GenericMissions.GenericAcceptLogbookEntry&quot;]">
		<set_value name="$DebugChance" exact="md.kuertee_professions_guilds.UserSettings.$debugChance3" />
		<set_value name="namespace.$kProfs_timeStart" exact="player.age" />
    </add>
<!--
    ADD BEFORE. purpose: to add a multiplier, in this case, RAP's bonus multiplier, to the reward.
    <cue name="MissionEnded">
        <do_if value="$RewardCr gt $RewardCapCr">
-->
    <add pos="before" sel="//cue[@name=&quot;MissionEnded&quot;]//do_if[@value=&quot;$RewardCr gt $RewardCapCr&quot;]">
        <!-- input: $OfferType, $MissionThread, $Reward_Money__Result output: $Reward_Money__Result_Multiplied -->
        <set_value name="$Reward_Money__Result" exact="$RewardCr" />
        <include_actions ref="md.LIB_Reward_Balancing.Apply_RewardMultiplier" comment="signal leak and mission thread bonus"/>
        <set_value name="$RewardCr" exact="$Reward_Money__Result_Multiplied" />
        <remove_value name="$Reward_Money__Result" />
        <remove_value name="$Reward_Money__Result_Multiplied" />
    </add>
<!--
    ADD PREPEND. purpose: to add a multiplier, in this case, RAP's bonus multiplier, to the reward.
    <cue name="MissionEnded">
        <do_elseif value="$RewardCr">
-->
    <add pos="prepend" sel="//cue[@name=&quot;MissionEnded&quot;]//do_elseif[@value=&quot;$RewardCr&quot;]">
        <!-- input: $OfferType, $MissionThread, $Reward_Money__Result output: $Reward_Money__Result_Multiplied -->
        <set_value name="$Reward_Money__Result" exact="$RewardCr" />
        <include_actions ref="md.LIB_Reward_Balancing.Apply_RewardMultiplier" comment="signal leak and mission thread bonus"/>
        <set_value name="$RewardCr" exact="$Reward_Money__Result_Multiplied" />
        <remove_value name="$Reward_Money__Result" />
        <remove_value name="$Reward_Money__Result_Multiplied" />
    </add>
<!--
    <cue name="MissionEnded">
        <set_value name="stat.missions_completed" operation="add"/>
-->
    <add pos="after" sel="//cue[@name=&quot;MissionEnded&quot;]//set_value[@name=&quot;stat.missions_completed&quot;][@operation=&quot;add&quot;]">
        <set_value name="namespace.$kProfs_isSuccess" exact="true" />
        <set_value name="namespace.$kProfs_rewardCr" exact="$RewardCr" />
        <set_value name="namespace.$kProfs_rewardObj" exact="$RewardObj" />
    </add>
<!--
    <cue name="CleanUp">
        <actions>
-->
    <add pos="prepend" sel="//cue[@name=&quot;CleanUp&quot;]/actions">
        <do_if value="@namespace.$kProfs_timeStart">
            <signal_cue_instantly cue="md.kuertee_professions.GMMissionEnd" param="table[
                $profRepu = md.kuertee_professions.kProfs.$prof_Builder,
                $activityId = if @namespace.$kProfs_isSuccess then md.kuertee_professions.kProfs.$activity_full_mission_success else md.kuertee_professions.kProfs.$activity_full_mission_failure,
                $missionLib = namespace,
                $rewardCr = @namespace.$kProfs_rewardCr,
                $rewardObj = @namespace.$kProfs_rewardObj
            ]" />
        </do_if>
    </add>
</diff>
