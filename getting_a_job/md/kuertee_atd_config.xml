<?xml version="1.0" encoding="utf-8"?>
<mdscript name="kuertee_atd_config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
	<cues>
		<cue name="Config" namespace="this" version="1">
			<actions>
			</actions>
		</cue>
		<cue name="StartSMO" instantiate="true">
			<conditions>
				<event_cue_signalled cue="md.Simple_Menu_Options.Reloaded" />
			</conditions>
			<actions>
				<!-- <debug_text text="'signal_cue_instantly ' + @md.Simple_Menu_API.Register_Options_Menu" /> -->
				<signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu"
					param="table[
						$id = 'kuertee_atd_extension_options_menu',
						$columns = 2,
						$title = {111204, 1},
						$onOpen = BuildOptionsMenu
					]" />
				<cancel_cue cue="this" />
			</actions>
		</cue>
		<cue name="BuildOptionsMenu" instantiate="true">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<debug_text text="''" />
				<set_value name="$levels" exact="[
					level.medium,
					level.hard,
					level.veryhard,
					level.impossible
				]" />
				<set_value name="$rewardEgTextByLevels" exact="table[]" />
				<do_all counter="$i" exact="$levels.count">
					<set_value name="$MissionThread" exact="null" />
					<set_value name="$OfferType" exact="null" />
					<signal_cue_instantly cue="md.LIB_Reward_Balancing.Reward_Money" param="[namespace, $levels.{$i}, 1, faction.argon]" comment="basic reward credits" />
					<include_actions ref="md.LIB_Reward_Balancing.Apply_RewardMultiplier" comment="signal leak and mission thread bonus" />
					<!-- <debug_text text="$levels.{$i} + ': ' + $Reward_Money__Result_Multiplied.formatted.{'%s %Cr'}" /> -->
					<set_value name="$rewardEgTextByLevels.{$levels.{$i}}" exact="$Reward_Money__Result_Multiplied.formatted.{'%s %Cr'}" />
					<remove_value name="$MissionThread" />
					<remove_value name="$OfferType" />
				</do_all>
				<remove_value name="$levels" />

				<!-- <t id="58">Ironman mode</t>
				<t id="59">One save slot. You can only load from one save slot. Autosaves and quicksaves are exempt.</t>
				<t id="60">Saved games</t> -->
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 60}, $color='Helper.color.blue']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 58}]" />
				<!-- <t id="4825">Enabled</t> -->
				<do_if value="md.kuertee_atd.kATD.$userIsIronManMode and (not md.kuertee_atd.kATD.$debugChance)">
					<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=2, $text={1001, 4825}, $color='Helper.color.green']" />
				</do_if>
				<do_else>
					<signal_cue_instantly cue="md.Simple_Menu_API.Make_CheckBox"
						param="table[
							$id = 'userIsIronManMode',
							$checked = md.kuertee_atd.kATD.$userIsIronManMode,
							$col = 2,
							$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
							$default = false,
							$mouseOverText = {1001, 2661} + ': ' + {1001, 2649},
							$onClick = OnSMOCheckboxChange
						]" comment="2661 = Defaults, 2649 = 'off', 2648 = 'on'" />
				</do_else>
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=2, $text={111204, 59}, $wordwrap=true]" />

				<!-- <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 39}]" />
				<run_actions ref="md.Userdata.Read" result="md.kuertee_atd.kATD.$userDeadIsDead">
					<param name="Owner" value="'kuertee_alternatives_to_death'"/>
					<param name="Key" value="'userDeadIsDead'"/>
					<param name="Default" value="false"/>
				</run_actions>
				<signal_cue_instantly cue = "md.Simple_Menu_API.Make_CheckBox"
					param = "table[
						$id = 'userDeadIsDead',
						$checked = md.kuertee_atd.kATD.$userDeadIsDead,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$default = false,
						$mouseOverText = {1001, 2661} + ': ' + {1001, 2649},
						$onClick = OnSMOCheckboxChange
					]" comment="2661 = Defaults, 2649 = 'off', 2648 = 'on'" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=2, $text={111204, 40}, $wordwrap=true]" /> -->

				<!-- <t id="51">"Save scum" penalties</t>
				<t id="52">Death penalty</t>
				<t id="53">One of active death alternatives will be applied when "save scumming" is detected.</t>
				<t id="54">Credits penalty</t>
				<t id="55">Credits will be removed from the player's personal cash when "save scumming" is detected.</t>
				<t id="56">Time</t>
				<t id="57">"Save scumming" is detected when the game-time of a loaded game is older than this given time.</t> -->

				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 51}]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 56}, $halign = 'right']" />
				<signal_cue_instantly
					cue="md.Simple_Menu_API.Make_Slider"
					param="table[
						$id = 'userSaveScumPenalty_timeMinutes',
						$start = md.kuertee_atd.kATD.$userSaveScumPenalty_timeMinutes,
						$col = 2,
						$text = table[$text=''],
						$min = 1, $max = 5 * 60, $step = 1, $suffix='min',
						$default = 60,
						$mouseOverText = {1001,2661} + ': 60 min',
						$onSliderCellChanged = OnSMOSliderChange
					]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=2, $text={111204, 57}, $wordwrap=true]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 52}, $halign='right']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_CheckBox"
					param="table[
						$id = 'userSaveScumPenalty_death',
						$checked = md.kuertee_atd.kATD.$userSaveScumPenalty_death,
						$col = 2,
						$width = 'Helper.standardButtonHeight', $height = 'Helper.standardButtonHeight',
						$default = false,
						$mouseOverText = {1001, 2661} + ': ' + {1001, 2649},
						$onClick = OnSMOCheckboxChange
					]" comment="2661 = Defaults, 2649 = 'off', 2648 = 'on'" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=2, $text={111204, 53}, $wordwrap=true]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 54}, $halign='right']" />
				<signal_cue_instantly
					cue="md.Simple_Menu_API.Make_Slider"
					param="table[
						$id = 'userSaveScumPenalty_creditsPerc',
						$start = md.kuertee_atd.kATD.$userSaveScumPenalty_creditsPerc,
						$col = 2,
						$text = table[$text=''],
						$min = 0, $max = 100, $step = 1, $suffix='%',
						$default = 50,
						$mouseOverText = {1001,2661} + ': 50%',
						$onSliderCellChanged = OnSMOSliderChange
					]" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=2, $text={111204, 55}, $wordwrap=true]" />

				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text='']" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
				<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col=1, $text={111204, 5}, $halign = 'right']" />
				<signal_cue_instantly
					cue="md.Simple_Menu_API.Make_Dropdown"
					param="table[
						$id = 'userCloneCostLevel',
						$col = 2,
						$options = [
							table[$text={1001, 4004} + ' (' + $rewardEgTextByLevels.{level.medium} + ')', $value=level.medium],
							table[$text={1001, 4005} + ' (' + $rewardEgTextByLevels.{level.hard} + ')', $value=level.hard],
							table[$text={1001, 4006} + ' (' + $rewardEgTextByLevels.{level.veryhard} + ')', $value=level.veryhard],
							table[$text={1001, 4007} + ' (' + $rewardEgTextByLevels.{level.impossible} + ')', $value=level.impossible]
						],
						$startOption = if md.kuertee_atd.kATD.$userCloneCostLevel == level.medium then 4 else (
							if md.kuertee_atd.kATD.$userCloneCostLevel == level.hard then 5 else (
								if md.kuertee_atd.kATD.$userCloneCostLevel == level.veryhard then 6 else (
									if md.kuertee_atd.kATD.$userCloneCostLevel == level.impossible then 7
								)
							)
						),
						$mouseOverText = {1001,2661} + ': ' + {1001, 4001},
						$onDropDownConfirmed = onDropDownConfirmed
					]" />
			</actions>
		</cue>
		<cue name="OnSMOSliderChange" instantiate="true">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<debug_text text="event.param.$id + ' pre: ' + md.kuertee_atd.kATD.{'$' + event.param.$id}" chance="md.kuertee_atd.kATD.$debugChance" />
				<set_value name="md.kuertee_atd.kATD.{'$' + event.param.$id}" exact="event.param.$value" />
				<debug_text text="event.param.$id + ' post: ' + md.kuertee_atd.kATD.{'$' + event.param.$id}" chance="md.kuertee_atd.kATD.$debugChance" />
				<cancel_cue cue="this" />
			</actions>
		</cue>
		<cue name="OnSMOCheckboxChange" instantiate="true">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<debug_text text="event.param.$id + ' pre: ' + md.kuertee_atd.kATD.{'$' + event.param.$id}" chance="md.kuertee_atd.kATD.$debugChance" />
				<do_if value="event.param.$id == 'debugChance'">
					<set_value name="md.kuertee_atd.kATD.{'$' + event.param.$id}" exact="if event.param.$checked then 100 else 0" />
					<signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu" />
				</do_if>
				<do_else>
					<set_value name="md.kuertee_atd.kATD.{'$' + event.param.$id}" exact="event.param.$checked" />
				</do_else>
				<debug_text text="event.param.$id + ' post: ' + md.kuertee_atd.kATD.{'$' + event.param.$id}" chance="md.kuertee_atd.kATD.$debugChance" />
				<cancel_cue cue="this" />
			</actions>
		</cue>
		<cue name="onDropDownConfirmed" instantiate="true">
			<conditions>
				<event_cue_signalled />
			</conditions>
			<actions>
				<debug_text text="event.param.$id + ' to: ' + @event.param.$option.$text + ' value: ' + @event.param.$option.$value" />
				<debug_text text="event.param.$id + ' pre: ' + md.kuertee_atd.kATD.{'$' + event.param.$id}" chance="md.kuertee_atd.kATD.$debugChance" />
				<set_value name="md.kuertee_atd.kATD.{'$' + event.param.$id}" exact="(event.param.$option.$value)" />
				<debug_text text="event.param.$id + ' post: ' + md.kuertee_atd.kATD.{'$' + event.param.$id}" chance="md.kuertee_atd.kATD.$debugChance" />
				<cancel_cue cue="this" />
			</actions>
		</cue>
	</cues>
</mdscript>