<?xml version="1.0" encoding="utf-8"?>
<mdscript name="GettingAJobTest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../xsd/md.xsd">
  <cues>
    <cue name="Work" namespace="this" version="1">
      <conditions>
        <check_any>
          <event_game_loaded />
          <event_game_started />
          <event_player_created />
          <event_cue_signalled cue="md.Setup.Start" />
        </check_any>
        <check_value value="not @player.allmodules.{player.module}.isscenario" />
      </conditions>
      <actions>
        <set_value name="global.$GettingAJob_Work" exact="this" />

        <set_value name="Work.$Debug" exact="0" />
        <set_value name="Work.$EscapePods" exact="[]" />

        <set_value name="$NextPaycheck" exact="player.age" />
        <set_value name="$MissionRewardReducer" exact="16" />
        <set_value name="$PaycheckInterval" exact="(15 * 60)s" />
        <set_value name="$InactiveTime" exact="(120 * 60)s" />
        <!--
        GettingAJob.$Factions.{$faction} = table[
        (dynamic variables):
          $missionGroup = missiongroup.gaj_factionname,
          $hired = bool,
          $inactive = bool, (true if player has not completed a mission in a while)
          $pension = float,
          $pensionTier = int, (0 < 15, 1 = 15, 2 = 20, 3 = 25, 4 = 30)
          $paycheck = float,
          $missionTime = time,
          $isSpy = bool,
        (static variables):
          $paycheckFactor = float,
          $pensionFactor = float,
          $bonusMultiplier = float,
          $offerJob = bool, (true when manager offers job)
          $offerSpy = bool, (true when manager offers spy position)
        ] -->
        <set_value name="$Factions" exact="table[]" /> <!-- table populates when player begins working for a faction -->

        <set_value name="$BasePays" exact="table[
          {tag.peaceful} = 25000,
          {tag.police} = 10000,
          {tag.plunder} = 4000
        ]" />
        <!-- mission pay added to paycheck -->
        <set_value name="$SpyPays" exact="table[
          {tag.peaceful} = 15000,
          {tag.police} = 10000,
          {tag.plunder} = 8000
        ]" />
        <!-- mission reward increased by:
        40%, 100%, 250%
        -->
        <set_value name="$BonusPays" exact="table[
          {tag.peaceful} = 0.4, 
          {tag.police} = 1,
          {tag.plunder} = 2.5
        ]" />
        <!-- mission pay added to paycheck -->
        <set_value name="$PaycheckFactors" exact="table[
          {tag.peaceful} = 0.0075,
          {tag.police} = 0.01,
          {tag.plunder} = 0.015
        ]" />
        <!-- mission pay added to paycheck -->
        <set_value name="$PensionFactors" exact="table[
          {tag.peaceful} = 0.05,
          {tag.police} = 0.025,
          {tag.plunder} = 0.01
        ]" />
        <!-- Work Mission Groups -->
        <set_value name="$MissionGroups" exact="table[
          {faction.anoat} = missiongroup.gaj_anoat,
          {faction.ascendancy} = missiongroup.gaj_ascendancy,
          {faction.baobab} = missiongroup.gaj_baobab,
          {faction.blacksun} = missiongroup.gaj_blacksun,
          {faction.bountyhunters} = missiongroup.gaj_bountyhunters,
          {faction.commerceguild} = missiongroup.gaj_commerceguild,
          {faction.corellia} = missiongroup.gaj_corellia,
          {faction.corporate} = missiongroup.gaj_corporate,
          {faction.galempire} = missiongroup.gaj_galempire,
          {faction.hapes} = missiongroup.gaj_hapes,
          {faction.hoersh} = missiongroup.gaj_hoersh,
          {faction.huttcartel} = missiongroup.gaj_huttcartel,
          {faction.huttpirates} = missiongroup.gaj_huttpirates,
          {faction.incom} = missiongroup.gaj_incom,
          {faction.kamino} = missiongroup.gaj_kamino,
          {faction.kuat} = missiongroup.gaj_kuat,
          {faction.mandodw} = missiongroup.gaj_mandodw,
          {faction.mandoraiders} = missiongroup.gaj_mandoraiders,
          {faction.miningguild} = missiongroup.gaj_miningguild,
          {faction.moncal} = missiongroup.gaj_moncal,
          {faction.naboo} = missiongroup.gaj_naboo,
          {faction.newrepublic} = missiongroup.gaj_newrepublic,
          {faction.rebelalliance} = missiongroup.gaj_rebelalliance,
          {faction.rendili} = missiongroup.gaj_rendili,
          {faction.sienar} = missiongroup.gaj_sienar,
          {faction.sith} = missiongroup.gaj_sith,
          {faction.tagge} = missiongroup.gaj_tagge,
          {faction.bankingclan} = missiongroup.gaj_bankingclan,
          {faction.tradefederation} = missiongroup.gaj_tradefederation,
          {faction.transgalmeg} = missiongroup.gaj_transgalmeg,
          {faction.twinsuns} = missiongroup.gaj_twinsuns,
          {faction.valarian} = missiongroup.gaj_valarian
        ]" />
        <!-- hacking device list -->
        <set_value name="$HackingDeviceList" exact="table[
          {faction.anoat} = ware.inv_spydevice_anoat,
          {faction.ascendancy} = ware.inv_spydevice_ascendancy,
          {faction.commerceguild} = ware.inv_spydevice_commerceguild,
          {faction.corporate} = ware.inv_spydevice_corporate,
          {faction.galempire} = ware.inv_spydevice_galempire,
          {faction.hapes} = ware.inv_spydevice_hapes,
          {faction.huttcartel} = ware.inv_spydevice_huttcartel,
          {faction.kamino} = ware.inv_spydevice_kamino,
          {faction.mandodw} = ware.inv_spydevice_mandodw,
          {faction.naboo} = ware.inv_spydevice_naboo,
          {faction.newrepublic} = ware.inv_spydevice_newrepublic,
          {faction.rebelalliance} = ware.inv_spydevice_rebelalliance,
          {faction.sith} = ware.inv_spydevice_sith,

          {faction.tradefederation} = ware.inv_hackingdevice,
          {faction.tagge} = ware.inv_hackingdevice,
          {faction.sienar} = ware.inv_hackingdevice,
          {faction.rendili} = ware.inv_hackingdevice,
          {faction.baobab} = ware.inv_hackingdevice,
          {faction.bountyhunters} = ware.inv_hackingdevice,
          {faction.corellia} = ware.inv_hackingdevice,
          {faction.hoersh} = ware.inv_hackingdevice,
          {faction.incom} = ware.inv_hackingdevice,
          {faction.kuat} = ware.inv_hackingdevice,
          {faction.miningguild} = ware.inv_hackingdevice,
          {faction.moncal} = ware.inv_hackingdevice,
          {faction.bankingclan} = ware.inv_hackingdevice,
          {faction.transgalmeg} = ware.inv_hackingdevice,
          {faction.twinsuns} = ware.inv_hackingdevice,
          {faction.blacksun} = ware.inv_hackingdevice,
          {faction.huttpirates} = ware.inv_hackingdevice,
          {faction.mandoraiders} = ware.inv_hackingdevice,
          {faction.valarian} = ware.inv_hackingdevice
        ]" />
        <set_value name="$InitSetup" exact="true" />
      </actions>
      <cues>
        <cue name="Init">
          <conditions>
            <check_any>
              <event_game_loaded />
              <event_game_started />
              <event_player_created />
              <event_cue_signalled />
            </check_any>
            <check_value value="not @player.allmodules.{player.module}.isscenario" />
          </conditions>
          <delay exact="1ms" />
          <actions>
            <set_value name="global.$GettingAJob_Work.$Debug" exact="100" />
            <do_if value="$InitSetup">
              <signal_cue_instantly cue="InitSetup" />
            </do_if>
            <do_else>
              <reset_cue cue="Init" />
            </do_else>
          </actions>
          <cues>
            <cue name="InitSetup" instantiate="true">
              <conditions>
                <event_cue_signalled />
              </conditions>
              <delay exact="1ms" />
              <actions>
                <!-- send job offer to factions with ge 12 relation -->
                <do_for_each name="$faction" in="md.$FactionData.keys.list">
                  <do_if value="$faction.relationto.{faction.player} ge 0.01592425">
                    <signal_cue_instantly cue="OfferJob" param='$faction' />
                  </do_if>
                </do_for_each>

                <!-- <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.name}"" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]"
                -->
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.anoat}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.ascendancy}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.baobab}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.bountyhunters}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.commerceguild}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.corellia}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.corporate}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.galempire}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.hoersh}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.huttcartel}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.incom}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.kamino}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.kuat}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.mandodw}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.miningguild}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.moncal}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.newrepublic}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.rebelalliance}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.rendili}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.sienar}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.tagge}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.bankingclan}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.tradefederation}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.transgalmeg}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.twinsuns}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_neutral,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <!-- pirates -->
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.blacksun}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.huttpirates}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.mandoraiders}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.valarian}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <!-- reclusive -->
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.hapes}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.naboo}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="md.kuertee_emergent_missions_requirements_by_faction.Requirements.$ByFaction.{faction.sith}" exact="table[
                  $isDisabled                         = false,
                  $mission_escort_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_escort_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_patrol_req_relLevel        = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_patrol_req_repuLevel       = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_raid_req_relLevel          = md.kuertee_emergent_missions.UserSettings.$req_rel_warSubscription,
                  $mission_raid_req_repuLevel         = md.kuertee_emergent_missions.UserSettings.$req_none,
                  $mission_defendPirate_req_relLevel  = md.kuertee_emergent_missions.UserSettings.$req_rel_friend,
                  $mission_defendPirate_req_repuLevel = md.kuertee_emergent_missions.UserSettings.$req_none
                ]" />
                <set_value name="$InitSetup" exact="false" />
                <reset_cue cue="parent" />
              </actions>
            </cue>
          </cues>
        </cue>

        <!-- Paycheck -->
        <!-- must convert to credits by multiplying by 100 -->
        <cue name="IssuePaycheck" instantiate="true" checkinterval="5s">
          <conditions>
            <check_age min="$NextPaycheck" />
          </conditions>
          <actions>
            <set_value name="$NextPaycheck" exact="player.age + $PaycheckInterval" />
            <do_for_each name="$faction" in="$Factions.keys.list">
              <do_if value="$Factions.{$faction}.$hired and not $Factions.{$faction}.$inactive">
                <do_if value="player.age - $Factions.{$faction}.$missionTime ge $InactiveTime">
                  <set_value name="$Factions.{$faction}.$inactive" exact="true" />
                  <!-- todo: change text based on type of faction: police, peaceful, pirate, other? -->

                  <show_help force="true" duration="8s"
                    custom="'You have received a Priority Message from '+$faction.name" position="20" />
                  <write_incoming_message highpriority="true" source="$faction.name" title="'Inactive'" text="'
                    Greetings '+player.name+',\n
                    \n
                    Your paycheck has been paused until you complete a mission for us.\n
                    \n
                    ' +$faction+' Finance Department'" />
                </do_if>
                <do_else>
                  <set_value name="$money" exact="$Factions.{$faction}.$paycheck * 100" />
                  <signal_cue_instantly cue="md.GalacticBankRC3.Transfer" param="table[$faction= $faction, $money= $money, $message=$faction+' Paycheck: '+$money/100]" />
                </do_else>
              </do_if>
              <do_elseif value="@$Factions.{$faction}.$pension gt 0">
                <set_value name="$money" exact="$Factions.{$faction}.$pension * 100" />
                <signal_cue_instantly cue="md.GalacticBankRC3.Transfer" param="table[$faction= $faction, $money= $money, $message=$faction+' Pension: '+$money/100]" />
              </do_elseif>
            </do_for_each>
          </actions>
        </cue>

        <!-- update pension -->
        <cue name="Pension" instantiate="true">
          <conditions>
            <event_player_relation_changed />
            <check_value value="event.object == null and event.param != null" />
            <check_value value="@$Factions.{event.param}.$hired and not @$Factions.{event.param}.$inactive" />
            <check_any>
              <check_value value="$Factions.{event.param}.$pensionTier == 0 and event.param.relationto.{faction.player} ge 0.032" />
              <check_value value="$Factions.{event.param}.$pensionTier == 1 and event.param.relationto.{faction.player} ge 0.1" />
              <check_value value="$Factions.{event.param}.$pensionTier == 2 and event.param.relationto.{faction.player} ge 0.32" />
              <check_value value="$Factions.{event.param}.$pensionTier == 3 and event.param.relationto.{faction.player} ge 1" />
            </check_any>
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param" />
            <set_value name="$Factions.{$faction}.$pensionTier" operation="add" exact="1" />

            <show_help force="true" duration="8s"
              custom="'You have received a Priority Message from '+$faction.name" position="20" />
            <write_incoming_message highpriority="true" source="$faction.name" title="$faction+': Pension Level '+$Factions.{$faction}.$pensionTier" text="'We are please to inform you that your pension percent has increased to: '++'\n\nWe hope that you live forever.'" />
          </actions>
        </cue>

        <cue name="Death" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <!--
            GettingAJob.$Factions.{$faction} = table[
            (dynamic variables):
              $missionGroup = missiongroup.gaj_factionname,
              $hired = bool,
              $inactive = bool, (true if player has not completed a mission in a while)
              $pension = float,
              $pensionTier = int, (0 < 15, 1 = 15, 2 = 20, 3 = 25, 4 = 30)
              $paycheck = float,
              $missionTime = time,
              $isSpy = bool,
              $offerJob = bool,
              $offerSpy = bool,
            (static variables):
              $paycheckFactor = float,
              $pensionFactor = float,
              $bonusMultiplier = float,
              $basePay = int,
              $spyPay = int
            ] -->
            <do_for_each name="$faction" in="$Factions.keys.list">
              <set_value name="$Factions.{$faction}.$hired" exact="false" />
              <set_value name="$Factions.{$faction}.$inactive" exact="false" />
              <set_value name="$Factions.{$faction}.$pension" operation="add" exact="($Factions.{$faction}.$paycheck - $Factions.{$faction}.$pension) * $Factions.{$faction}.$pensionFactor * $Factions.{$faction}.$pensionTier" />
              <set_value name="$Factions.{$faction}.$pensionTier" exact="0" />
              <set_value name="$Factions.{$faction}.$paycheck" exact="0" />
              <set_value name="$Factions.{$faction}.$missionTime" exact="0" />
              <set_value name="$Factions.{$faction}.$isSpy" exact="false" />
              <set_value name="$Factions.{$faction}.$offerJob" exact="false" />
              <set_value name="$Factions.{$faction}.$offerSpy" exact="false" />
            </do_for_each>
          </actions>
        </cue>

        <!-- send job offer -->
        <cue name="OfferJob" instantiate="true">
          <conditions>
            <check_any>
              <event_cue_signalled />
              <check_all>
                <event_player_relation_changed />
                <check_value value="event.object == null and event.param != null" />
                <check_value value="not @$Factions.{event.param}.$hired and not @$Factions.{event.param}.$offerJob" />
                <check_value value="event.param.relationto.{faction.player} ge 0.01592425" />
              </check_all>
            </check_any>
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param" />
            <!-- first setup -->
            <do_if value="not @$Factions.{$faction}">
              <set_value name="$Factions.{$faction}" exact="table[]" />
              <set_value name="$Factions.{$faction}.$hired" exact="false" />
              <set_value name="$Factions.{$faction}.$inactive" exact="false" />
              <set_value name="$Factions.{$faction}.$offerSpy" exact="false" />
              <set_value name="$Factions.{$faction}.$pension" exact="0" />
              <set_value name="$Factions.{$faction}.$pensionTier" exact="0" />
              <set_value name="$Factions.{$faction}.$missionTime" exact="0" />
              <set_value name="$Factions.{$faction}.$isSpy" exact="false" />
              <set_value name="$Factions.{$faction}.$missionGroup" exact="$MissionGroups.{$faction}" />
            </do_if>
            <set_value name="$Factions.{$faction}.$offerJob" exact="true" />
            <do_for_each name="$tag" in="$BasePays.keys.list">
              <get_factions_by_tag tag="$tag" result="$taggedFactions" />
              <do_if value="$taggedFactions.indexof.{$faction}">
                <set_value name="$paycheck" exact="$BasePays.{$tag}" />
                <set_value name="$bonusMultiplier" exact="$BonusPays.{$tag}" />
                <set_value name="$Factions.{$faction}.$spyPay" exact="$SpyPays.{$tag}" />
                <set_value name="$Factions.{$faction}.$paycheckFactor" exact="$PaycheckFactors.{$tag}" />
                <set_value name="$Factions.{$faction}.$pensionFactor" exact="$PensionFactors.{$tag}" />
                <break />
              </do_if>
            </do_for_each>
            <set_value name="$Factions.{$faction}.$basePay" exact="$paycheck" />
            <set_value name="$Factions.{$faction}.$paycheck" exact="$paycheck" />
            <set_value name="$Factions.{$faction}.$bonusMultiplier" exact="$bonusMultiplier" />
            <set_value name="$offer" exact="'Pay: '+$paycheck+'Cr / '+$PaycheckInterval+'min\nMission Reward Bonus: '+$bonusMultiplier*100+'%'" />

            <show_help force="true" duration="8s"
              custom="'You have received a Priority Message from '+$faction.name" position="20" />
            <write_incoming_message highpriority="true" source="$faction.name" title="$faction+': Job Offer'" text="'We are please to inform you that we are offering a job to you. Please see one of our station managers to accept the position.\n\n'+$offer" />
          </actions>
        </cue>

        <!-- send spy offer -->
        <cue name="OfferSpy" instantiate="true">
          <conditions>
            <event_player_relation_changed />
            <check_value value="event.object == null and event.param != null" />
            <check_value value="not @$Factions.{event.param}" />
            <check_value value="event.param.relationto.{faction.player} ge 0.55" />
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param" />
            <set_value name="$Factions.{$faction}.$offerSpy" exact="true" />

            <show_help force="true" duration="8s"
              custom="'You have received a Priority Message from '+$faction.name" position="20" />
            <write_incoming_message highpriority="true" source="$faction.name" title="'Top Secret: Job Offer'" text="'Thank you for your loyalty. Please see one of our station managers.'" />
          </actions>
        </cue>

        <!-- param=table[
          $faction = $ClientOwner,
          $RewardCr = $RewardCr
        ] -->
        <cue name="LogWork" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param.$faction" />
            <set_value name="$RewardCr" exact="event.param.$RewardCr" />
            <set_value name="$workBonus" exact="$RewardCr * $Factions.{$faction}.$bonusMultiplier" />
            <set_value name="$RewardCr" exact="$RewardCr + $workBonus" />
            <set_value name="$Factions.{$faction}.$missionTime" exact="player.age" />
            <set_value name="$Factions.{$faction}.$paycheck" operation="add" exact="($RewardCr)f/100 * $Factions.{$faction}.$paycheckFactor" />
            <signal_cue_instantly cue="md.GalacticBankRC3.Transfer" param="table[$faction = $faction, $money = $RewardCr]" />
          </actions>
        </cue>

        <!-- Non-Pirate Manager Conversation -->
        <cue name="Convo_Start">
          <conditions>
            <check_any>
              <event_cue_signalled />
              <check_all>
                <event_conversation_started conversation="default" />
                <check_value value="not @event.object.hasrelation.enemy.{faction.player}" />
                <check_value value="event.object == @player.container.tradenpc" />
                <check_value value="event.object.trueowner != faction.player" />
                <check_value value="not event.object.trueowner.hastag.pirate" />
                <check_value value="event.object.owner.relationto.{faction.player} ge 0.01585" />
              </check_all>
            </check_any>
            <check_value value="player.container.isclass.station" />
          </conditions>
          <actions>
            <do_if value="event.name == 'event_cue_signalled'">
              <set_value name="$manager" exact="@event.param.$manager" />
              <set_value name="$faction" exact="$manager.trueowner" />
              <set_value name="$convoOption_isGetHired" exact="@event.param.$convoOption_isGetHired" />
              <set_value name="$convoOption_isBecomeSpy" exact="@event.param.$convoOption_isBecomeSpy" />
            </do_if>
            <do_else>
              <set_value name="$manager" exact="event.object" />
              <set_value name="$faction" exact="$manager.trueowner" />
              <set_value name="$convoOption_isGetHired" exact="false" />
              <set_value name="$convoOption_isBecomeSpy" exact="false" />
              <do_if value="@$Factions.{$faction}.$offerJob">
                <set_value name="$convoOption_isGetHired" exact="true" />
              </do_if>
              <do_elseif value="@$Factions.{$faction}.$offerSpy">
                <set_value name="$convoOption_isBecomeSpy" exact="true" />
              </do_elseif>
            </do_else>
            <do_if value="
                  event.name == 'event_conversation_started' and @md.ExtendedConversationMenu.Main.exists
                  and
                  (@$convoOption_isGetHired or @$convoOption_isBecomeSpy)
                ">
              <set_value name="md.ExtendedConversationMenu.Main.$convOptions.$GAJ_GettingAJob" exact="table[
                    $signalCue = Convo_Start,
                    $params = table[$manager = $manager, $convoOption_isGetHired = @$convoOption_isGetHired, $convoOption_isBecomeSpy = @$convoOption_isBecomeSpy]
                  ]" />
            </do_if>
            <do_else>
              <do_if value="$convoOption_isGetHired">
                <add_player_choice text="'Accept Job'" section="GAJ_get_hired" choiceparam="$faction" />
              </do_if>
              <do_if value="$convoOption_isBecomeSpy">
                <!-- spy pay logic goes here-->
                <add_player_choice text="'Become a Spy'" section="GAJ_become_spy" choiceparam="$faction" />
              </do_if>
              <add_player_choice text="'Job Status'" section="GAJ_status" choiceparam="$faction" />
            </do_else>
            <reset_cue cue="this" />
          </actions>
        </cue>
        <cue name="Convo_Continue">
          <conditions>
            <event_conversation_next_section sectionprefix="GAJ_" />
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param2" />
            <!--
              GettingAJob.$Factions.{$faction} = table[
              (dynamic variables):
                $missionGroup = missiongroup.gaj_factionname,
                $hired = bool,
                $inactive = bool, (true if player has not completed a mission in a while)
                $pension = float,
                $pensionTier = int, (0 < 15, 1 = 15, 2 = 20, 3 = 25, 4 = 30)
                $paycheck = float,
                $missionTime = time,
                $isSpy = bool,
              (static variables):
                $paycheckFactor = float,
                $pensionFactor = float,
                $bonusMultiplier = float,
                $offerJob = bool, (true when manager offers job)
                $offerSpy = bool, (true when manager offers spy position)
              ] -->
            <do_if value="event.param == 'GAJ_get_hired'">
              <signal_cue_instantly cue="GetHired" param="$faction" />
            </do_if>
            <do_elseif value="event.param == 'GAJ_become_spy'">
              <signal_cue_instantly cue="BecomeSpy" param="$faction" />
            </do_elseif>
            <do_elseif value="event.param == 'GAJ_status'">
              <signal_cue_instantly cue="GetJobStatus" param="$faction" />
            </do_elseif>
            <reset_cue cue="this" />
          </actions>
        </cue>

        <cue name="GetHired" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param" />
            <set_value name="$Factions.{$faction}.$offerJob" exact="false" />
            <set_value name="$Factions.{$faction}.$hired" exact="true" />
            <set_value name="$Factions.{$faction}.$missionTime" exact="player.age" />
            <set_value name="$Factions.{$faction}.$paycheck" operation="add" exact="$Factions.{$faction}.$pension" />
            <find_sector name="$sectors" owner="$faction" multiple="true" />
            <set_value name="$sectorMacros" exact="[]" />
            <do_for_each name="$sector" in="$sectors">
              <append_to_list name="$sectorMacros" exact="$sector.macro" />
            </do_for_each>
            <run_actions ref="md.LIB_Generic.UncoverMap_SectorsAndGates">
              <param name="InitialMap" value="$sectorMacros" />
              <param name="UncoverStationFaction" value="$faction" />
            </run_actions>
            <set_value name="$message" exact="'
              Paycheck: '+$data.$paycheck+'\n
              Mission Pay Bonus: '+$data.$bonusMultiplier*100+'%'+'\n
              % of Mission Pay added to Paycheck: '+$data.$paycheckFactor*100+'%'
            " />
            <do_if value="$data.$pension gt 0">
              <set_value name="$message" exact="$message+'\n
                Active Pension (included in paycheck): '+$data.$pension
              " />
            </do_if>

            <show_help force="true" duration="8s"
              custom="'You have received a Priority Message from '+$faction.name" position="20" />
            <write_incoming_message highpriority="true" source="$faction.name" title="'New Hire: '+$faction" text="$message" />
          </actions>
        </cue>

        <cue name="BecomeSpy" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param" />
            <set_value name="$Factions.{$faction}.$offerSpy" exact="false" />
            <set_value name="$Factions.{$faction}.$isSpy" exact="true" />
            <set_value name="$Factions.{$faction}.$paycheck" operation="add" exact="$Factions.{$faction}.$spyPay" />
            <add_inventory ware="ware.mod_ship_spy" />
            <add_inventory ware="$HackingDeviceList.{$faction}" />

            <show_help force="true" duration="8s"
              custom="'You have received a Priority Message from '+$faction.name" position="20" />
            <write_incoming_message highpriority="true" source="$faction.name" title="$faction+': ~Top Secret: New Spy~'" text="
                'Your spy pay of '+$Factions.{$faction}.$spyPay+' has been added to your paycheck.'
              " />
          </actions>
        </cue>

        <cue name="GetJobStatus" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <set_value name="$faction" exact="event.param" />
            <set_value name="$data" exact="$Factions.{$faction}" />
            <set_value name="$message" exact="'
              Hired: '+if $data.$hired then 'true' else 'false'
            " />
            <do_if value="$hired">
              <set_value name="$message" exact="$message+'\n
                Inactive: '+if $data.$inactive then 'true' else 'false'
              " />
            </do_if>
            <set_value name="$message" exact="$message+'\n
              Mission Pay Bonus: '+$data.$bonusMultiplier*100+'%'+'\n
              % of Mission Pay added to Paycheck: '+$data.$paycheckFactor*100+'%'+'\n
              Paycheck: '+$data.$paycheck
            " />
            <do_if value="$hired">
              <set_value name="$message" exact="$message+'\n
                Pension Tier: '+$data.$pensionFactor*$data.$pensionTier*100+'%'
              " />
            </do_if>
            <set_value name="$message" exact="$message+'\n
              Pension Tiers: 0%, '+$data.$pensionFactor*100+'%, '+$data.$pensionFactor*2*100+'%, '+$data.$pensionFactor*3*100+'%, '+$data.$pensionFactor*4*100+'%'
            " />
            <do_if value="$data.$pensionTier ge 1">
              <set_value name="$message" exact="$message+'\n
                % of Paycheck added to Pension: '+$data.$pensionTier * $data.$pensionFactor+'\n
                Pension After Death: '+$data.$pension + ($data.$paycheck - $data.$pension) * $data.$pensionTier * $data.$pensionFactor
              " />
            </do_if>
            <do_if value="$data.$missionTime gt 0">
              <set_value name="$message" exact="$message+'\n
                Last Mission Completed: '+(player.age - $data.$missionTime)*60
              " />
            </do_if>
            <do_if value="$data.$pension gt 0">
              <set_value name="$message" exact="$message+'\n
                Active Pension (included in paycheck): '+$data.$pension
              " />
            </do_if>
            <do_if value="$data.$isSpy">
              <set_value name="$message" exact="$message+'\n
                Spy Status: Active'
              " />
            </do_if>
            <write_incoming_message source="$faction.name" title="'Job Status: '+$faction" text="$message" />
          </actions>
        </cue>
      </cues>
    </cue>

    <cue name="OnLuaLoaderReady">
      <conditions>
        <event_ui_triggered screen="'Lua_Loader'" control="'Ready'" />
      </conditions>
      <actions>
        <raise_lua_event name="'Lua_Loader.Load'" param="'extensions.kuertee_ui_extensions.ui.kuertee_menu_interactmenu'" />
        <raise_lua_event name="'Lua_Loader.Load'" param="'extensions.getting_a_job.ui.menu_interactmenu_uix'" />
        <!-- <raise_lua_event name="'Lua_Loader.Load'" param="'extensions.getting_a_job.ui.sellships'" /> -->
        <raise_lua_event name="'Lua_Loader.Load'" param="'extensions.getting_a_job.ui.menu_transporter_uix'" />
      </actions>
    </cue>
    <cue name="OnLuaLoaderReadyCompleted">
      <conditions>
        <event_cue_completed cue="OnLuaLoaderReady" />
      </conditions>
      <actions>
        <reset_cue cue="OnLuaLoaderReady" />
        <reset_cue cue="this" />
      </actions>
    </cue>
  </cues>
</mdscript>