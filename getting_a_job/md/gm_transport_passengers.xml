<?xml version="1.0" encoding="utf-8"?>
<diff xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../xsd/mddiff.xsd">

  <!-- bar ~automated diff~ -->
  <add sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions" pos="before">
    <delay exact="1s" />
  </add>

  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions/create_dynamic_interior">
    <do_if value="$StartRoomName" exact="'{20007,1031}'">
      <find_room object="$StartContainer" name="$Bar">
        <match roomtype="roomtype.bar" />
      </find_room>
      <do_if value="$Bar">
        <find_npc_slot name="$NPC_Slot" object="$Bar" tags="tag.npc_generic" />
        <do_if value="$NPC_Slot">
          <include_actions ref="PlaceLeadPassenger_Placement" />
        </do_if>
      </do_if>
    </do_if>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions/do_if[@value='$DynamicInterior']/@value">not $NPC_Slot</replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions/do_if[@value='not $NPC_Slot']/debug_text">
    <create_dynamic_interior object="$StartContainer" corridor="$StartCorridorMacro" room="$StartRoomMacro" name="$StartRoomName" interiorname="$DynamicInterior" corridorname="$DynamicCorridor" roomname="$DynamicRoom" seed="$DynamicInteriorSeed" />
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions/do_if[@value='not $NPC_Slot']/set_dynamic_interior_private">
    <do_if value="$DynamicInterior">
      <debug_text text="'Created interior ' + $DynamicInterior + ' ' + $DynamicInterior.knownname" chance="$DebugChance" />
      <set_dynamic_interior_private object="$StartContainer" interior="$DynamicInterior" private="true" />
      <find_npc_slot name="$NPC_Slot" object="$DynamicRoom" tags="tag.npc_generic" />
      <do_if value="$NPC_Slot">
        <include_actions ref="PlaceLeadPassenger_Placement" />
      </do_if>
    </do_if>
  </replace>
  <replace sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions/do_if[@value='not $NPC_Slot']/find_npc_slot">
    <do_else>
      <!--TODO @Owen error code-->
      <debug_text text="'Unable to create dynamic interior'" />
      <assert value="false" text="'Unable to create dynamic interior'" />
    </do_else>
  </replace>
  <remove sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions/do_if[@value='not $NPC_Slot']/do_if[@value='$NPC_Slot']" />
  <remove sel="/mdscript/cues/library[@name='Start']/cues/cue[@name='Do_Start_Mission']/cues/cue[@name='MissionAccepted']/cues/cue[@name='ActivateMission']/cues/cue[@name='PlaceLeadPassenger']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior']/cues/cue[@name='PlaceLeadPassenger_WithinDynamicInterior_Create']/actions/do_else" />


  <!-- mission groups -->
  <add pos="before" sel="//create_offer[@cue=&quot;$MissionCue&quot;]">
    <do_if value="@md.GettingAJob.Work.$Factions.{$ClientOwner}.$hired">
      <set_value name="$MissionGroup" exact="@md.GettingAJob.Work.$Factions.{$ClientOwner}.$missionGroup" />
    </do_if>
  </add>

  <!-- unique to transport passengers -->
  <add pos="before" sel="//reward_player[@money='$RewardCr + $BonusCr']">
    <set_value name="$RewardCr" exact="$RewardCr + $BonusCr" />
  </add>

  <replace sel="//reward_player[@money='$RewardCr + $BonusCr']">
    <do_if value="not @player.allmodules.{player.module}.isscenario">
      <do_if value="[
        missiongroup.gaj_anoat,
        missiongroup.gaj_ascendancy,
        missiongroup.gaj_baobab,
        missiongroup.gaj_blacksun,
        missiongroup.gaj_bountyhunters,
        missiongroup.gaj_commerceguild,
        missiongroup.gaj_corellia,
        missiongroup.gaj_corporate,
        missiongroup.gaj_galempire,
        missiongroup.gaj_hapes,
        missiongroup.gaj_hoersh,
        missiongroup.gaj_huttcartel,
        missiongroup.gaj_huttpirates,
        missiongroup.gaj_incom,
        missiongroup.gaj_kamino,
        missiongroup.gaj_kuat,
        missiongroup.gaj_mandodw,
        missiongroup.gaj_mandoraiders,
        missiongroup.gaj_miningguild,
        missiongroup.gaj_moncal,
        missiongroup.gaj_naboo,
        missiongroup.gaj_newrepublic,
        missiongroup.gaj_rebelalliance,
        missiongroup.gaj_rendili,
        missiongroup.gaj_sienar,
        missiongroup.gaj_sith,
        missiongroup.gaj_tagge,
        missiongroup.gaj_bankingclan,
        missiongroup.gaj_tradefederation,
        missiongroup.gaj_transgalmeg,
        missiongroup.gaj_twinsuns,
        missiongroup.gaj_valarian
      ].indexof.{@$MissionGroup}">
        <set_value name="$GAJ_isWork" exact="true" />
      </do_if>
      <do_if value="$GAJ_isWork?">
        <signal_cue_instantly cue="md.GettingAJob.Work.LogWork" param="table[$faction = $ClientOwner, $RewardCr = $RewardCr]" />
      </do_if>
      <signal_cue_instantly cue="md.GalacticBank.Transfer" param="table[$faction = $ClientOwner, $money = $RewardCr]" />
    </do_if>
  </replace>
</diff>