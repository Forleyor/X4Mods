<?xml version="1.0" encoding="utf-8"?>

<!-- remove banking clan from normal tradestation faction logic-->
<diff xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../xsd/diff.xsd">
  <add
    sel="/mdscript/cues/library[@name='Manage_Stations']/cues/cue[@name='Process']/cues/cue[@name='Analyse_Stations']/actions/do_elseif[@value='@$DesiredTradeStationPatchMarker']"
    pos="after">
    <do_elseif value="$Faction == faction.bankingclan">
      <set_value name="$DesiredTradeStation" exact="0" />
    </do_elseif>
  </add>

  <!--   <mdscript name="FactionLogic_Stations" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../xsd/md.xsd">
  <cues>
    <cue name="Analyse_Stations">
      <conditions>
        <event_cue_signalled />
        <check_value value="$Faction.isactive" />
      </conditions>
      <actions>
        <debug_text
          text="$DebugText + 'Prepare to analyse known stations. Number of relevant sectors: ' +
$RelevantSectors.count"
          chance="$DebugChance" context="false" />
        <set_value name="$PreferredSectors" exact="[]" /> -->

  <add sel="//set_value[@name='$PreferredSectors']">
    <!-- BEGIN Banking Clan's Vault -->
    <do_if value="$Faction == faction.bankingclan">

      <set_value name="$DesiredTradeStation" exact="9" />
      <do_if value="$TradeStationCount lt $DesiredTradeStation">
        <debug_text
          text="$DebugText + 'Has ' + $TradeStationCount + ' trade stations but desires ' + $DesiredTradeStation"
          chance="$DebugChance" context="false" />
        <set_value name="$TradeStationsToBuild" exact="1" />

        <do_if value="$TradeStationsToBuild gt 0">
          <set_value name="$StationDefinitions" exact="[]" />
          <set_value name="$StationTypeTag" exact="[tag.tradestation]" />
          <find_station_by_true_owner name="$hq" tradestation="true" functional="true"
            faction="$Faction" space="swi_clusterscipio_sector001_macro" />
          <do_if value="not $hq.count gt 0">
            <set_value name="$set" exact="'headquarters'" />
            <set_value name="$planTag" exact="[tag.headquarters]" />
            <append_to_list name="$PreferredSectors"
              exact="swi_clusterscipio_sector001_macro" />
          </do_if>
          <do_else>
            <!--check
                where wrecks are, create list of major factions missing tradestation-->
            <set_value
              name="$set" exact="'tradestation'" />
            <set_value name="$planTag"
              exact="[tag.tradestation]" />
            <find_station_by_true_owner name="$stations" tradestation="true"
              functional="true"
              faction="$Faction" space="swi_galaxy_macro" excluded="$hq" multiple="true" />
            <remove_value name="$hq" />
            <set_value name="$factionlist"
              exact="[faction.galempire, faction.ascendancy, faction.newrepublic, faction.commerceguild, faction.corporate, faction.huttcartel, faction.anoat, faction.mandodw]" />
            <do_all exact="$stations.count" counter="$i">
              <remove_from_list name="$factionlist" exact="stations.{$i}.sector.owner" />
            </do_all>
            <find_sector name="$RelevantSectors" multiple="true" owner="$factionlist.random"
              space="swi.galaxy" />
          </do_else>
          <get_module_set_macro type="@$set" result="$ModuleSetMacro" race="race.bankingclan" />
          <remove_value name="$set" />
          <do_if value="$ModuleSetMacro">
            <get_construction_plan result="$ConstructionPlan"
              rawname="$ConstructionPlanName"
              faction="$Faction" tags="@$planTag" />
            <append_to_list name="$StationDefinitions"
              exact="[$ConstructionPlan, $ConstructionPlanName]" />
          </do_if>
          <remove_value name="$planTag" />

          <do_if value="$PastStationMaxScoreTableOverrides.$IsTradeStation?">
            <set_value name="$PastStationMaxScoreTable"
              exact="$PastStationMaxScoreTableOverrides.$IsTradeStation" />
          </do_if>
          <do_else>
            <!--Default
              table-->
            <set_value name="$PastStationMaxScoreTable"
              exact="table[
                               $WasTradeStation = 1.0f,
                               $WasEquipmentDock = 0.25f,
                               $WasShipyard = 0.25f,
                               $WasWharf = 0.25f]" />
          </do_else>

          <!--TODO
            @Owen what if there are no stations defined but a god entry is allowed? Just remove this
            check?-->
          <do_if value="$StationDefinitions.count">
            <debug_text
              text="$DebugText + 'Faction is capable of constructing a trade station. Will now search for a location'"
              chance="$DebugChance" context="false" />

            <run_actions ref="Find_Location_And_Build_Station" result="$NewStations">
              <!--Faction
                params-->
              <param name="Faction" value="$Faction" />
              <param name="StationHistory" value="$StationHistory" />
              <param name="RelevantSectors" value="$RelevantSectors" />
              <param name="ClaimedSectors" value="$ClaimedSectors" />
              <param name="PreferredSectors" value="$PreferredSectors" />

              <!--Station
                params-->
              <param name="NumStations" value="$TradeStationsToBuild" />
              <param name="StationDefinitions" value="$StationDefinitions" />
              <param name="ModuleSetMacro" value="$ModuleSetMacro" />
              <!--TODO
                @Owen base the loadout level on the sector / station type-->
              <param name="LoadoutLevel" value="1" />

              <!--Station
                history analysis-->
              <param name="ExistingStationValName" value="'$IsTradeStation'" />
              <param name="PastStationValName" value="'$WasTradeStation'" />
              <param name="PastStationMaxScoreTable" value="$PastStationMaxScoreTable" />

              <param name="DebugText" value="$DebugText" />
              <param name="DebugChance" value="$DebugChance" />
            </run_actions>
            <set_value name="$TradeStationCount" operation="add" exact="$NewStations.count" />
          </do_if>
        </do_if>
      </do_if>
    </do_if>
    <!-- END Banking Clan's Vault -->
  </add>
</diff>
<!-- </actions>
    </cue>
  </cues>
</mdscript> -->