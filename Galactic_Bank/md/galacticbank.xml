<?xml version="1.0" encoding="utf-8"?>
<mdscript name="GalacticBank" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../../xsd/md.xsd">
	<cues>
		<cue name="Vault" namespace="this" version="1">
			<conditions>
				<check_any>
					<event_game_loaded />
					<event_game_started />
					<event_player_created />
					<event_cue_signalled cue="md.Setup.Start" />
				</check_any>
				<check_value value="not @player.allmodules.{player.module}.isscenario" />
			</conditions>
			<delay exact="1ms" />
			<actions>
				<set_value name="md.$FactionData.{faction.thebankingclan}" exact="table[]" />
				<set_value name="$SetupComplete" exact="false" />

				<!-- settings affecting all accounts -->
				<set_value name="$Fee30" exact="0" />
				<set_value name="$Rate30" exact="0.015" />
				<set_value name="$Period30" exact="10h" />
				<set_value name="$Fee20" exact="0.0025" />
				<set_value name="$Rate20" exact="0.0125" />
				<set_value name="$Period20" exact="12h" />
				<set_value name="$Fee10" exact="0.0025" />
				<set_value name="$Rate10" exact="0.01" />
				<set_value name="$Period10" exact="15h" />
				<set_value name="$Fee0" exact="0.005" />
				<set_value name="$Rate0" exact="0.0075" />
				<set_value name="$Period0" exact="20h" />
				<set_value name="$Fee9" exact="0.005" />
				<set_value name="$Rate9" exact="0.005" />
				<set_value name="$Period9" exact="24h" />
				<!--
          Vault.$Accounts = table[
            {$faction} = table[
							$balance = (float)ct,
							$fee = float,
							$rate = float,
							$period = time,
							$interest_time = time
            ]
          ]
        -->
				<set_value name="$Accounts" exact="table[
					{faction.thebankingclan} = table[],
					{faction.hapes} = table[],
					{faction.huttpirates} = table[],
					{faction.mandoraiders} = table[],
					{faction.valarian} = table[],
					{faction.blacksun} = table[],
					{faction.naboo} = table[],
					{faction.sith} = table[],
					{faction.kamino} = table[],
					{faction.rebelalliance} = table[]
				]" />
				<set_value name="$Accounts.{faction.thebankingclan}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.hapes}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.huttpirates}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.mandoraiders}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.valarian}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.blacksun}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.naboo}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.kamino}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.rebelalliance}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />
				<set_value name="$Accounts.{faction.sith}" exact="table[
					$balance = 0,
					$fee = 0.0025,
					$rate = 0.0075,
					$period = 20h,
					$interest_time = null,
					$undockedFee = 0.0025
				]" />

				<!-- factions with branch vaults and offices -->
				<set_value name="$MajorFactionList" exact="table[
					{faction.galempire} = true,
					{faction.ascendancy} = true,
					{faction.newrepublic} = true,
					{faction.commerceguild} = true,
					{faction.corporate} = true,
					{faction.huttcartel} = true,
					{faction.anoat} = true,
					{faction.mandodw} = true
				]" />

				<!-- temp variables -->
				<set_value name="$Relation" exact="0" />
				<set_value name="$Interior" exact="null" />
				<set_value name="$Corridor" exact="null" />
				<set_value name="$Room" exact="null" />
				<set_value name="$Banker" exact="null" />
				<set_value name="$StationTable" exact="null" />
				<set_value name="$StationInterior" exact="null" />
			</actions>
			<cues>
				<cue name="Init">
					<conditions>
						<check_any>
							<event_game_loaded />
							<event_game_started />
							<event_player_created />
							<event_cue_signalled />
						</check_any>
						<check_value value="not @player.allmodules.{player.module}.isscenario" />
					</conditions>
					<delay exact="2s" />
					<actions>
						<do_if value="not $SetupComplete">
							<signal_cue_instantly cue="InitSetup" />
						</do_if>
						<!-- disable npc reactions bank loans -->
						<do_if value="md.kuertee_npc_reactions.NPCReactions.$userIsBankLoans?">
							<set_value name="md.kuertee_npc_reactions.NPCReactions.$userIsBankLoans" exact="false" />
						</do_if>
						<reset_cue cue="Init" />
					</actions>
					<cues>
						<cue name="InitSetup">
							<conditions>
								<event_cue_signalled />
								<check_value value="$SetupComplete == false" />
							</conditions>
							<actions>
								<!-- Clear old BNC ships and objects -->
								<find_object owner="[faction.thebankingclan, faction.bankingclan]" space="player.galaxy"
									name="$objects" multiple="true" />
								<do_for_each name="$object" in="$objects">
									<destroy_object object="$object" />
								</do_for_each>

								<!-- Create Stations -->
								<create_position name="$Position" max="20km" />
								<set_value name="$Y_Position" min="-5km" max="5km" />
								<set_value name="$Position" exact="position.[$Position.x, $Y_Position, $Position.z]" />
								<find_sector name="$sector" macro="macro.swi_clusterscipio_sector001_macro" />
								<create_station rawname="'{20777,1001} {20777,1005} - {20777,1003} {20777,1004}'"
									state="componentstate.operational"
									encyclopedia="true"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_mainvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<set_value name="$name"
									exact="'{20777,1001} {20777,1005} - {20777,1006} {20777,1004}'" />
								<find_sector name="$sector" macro="macro.swi_clusterbastion_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="true"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<find_sector name="$sector" macro="macro.swi_clustereriadu_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="false"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<find_sector name="$sector" macro="macro.swi_clustercoruscant_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="false"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<find_sector name="$sector" macro="macro.swi_clustercantonica_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="false"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<find_sector name="$sector" macro="macro.swi_clusterhypori_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="false"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<find_sector name="$sector" macro="macro.swi_clusternarshadda_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="false"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<find_sector name="$sector" macro="macro.swi_clusteranpath_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="false"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<find_sector name="$sector" macro="macro.swi_clustermandalore_sector001_macro" />
								<create_station rawname="$name" state="componentstate.operational"
									encyclopedia="false"
									name="$station"
									sector="$sector"
									owner="faction.thebankingclan" macro="macro.station_bankingclan_branchvault_macro"
									constructionplan="'vault_bankingclan'">
									<safepos allowyaxis="false" value="$Position" includeplotbox="true" />
								</create_station>
								<set_loadout_level object="$station" exact="0.9" />
								<signal_objects object="player.galaxy" param="'init station'" param2="$station"
									param3="false" />
								<remove_value name="$sector" />
								<remove_value name="$station" />

								<!-- set faction relations -->
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.anoat"
									value="0.2" />
								<set_faction_relation faction="faction.anoat"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.mandodw"
									value="0.2" />
								<set_faction_relation faction="faction.mandodw"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.huttcartel"
									value="0.2" />
								<set_faction_relation faction="faction.huttcartel"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.corporate"
									value="0.2" />
								<set_faction_relation faction="faction.corporate"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.commerceguild"
									value="0.2" />
								<set_faction_relation faction="faction.commerceguild"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.rebelalliance"
									value="0.2" />
								<set_faction_relation faction="faction.rebelalliance"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.newrepublic"
									value="0.2" />
								<set_faction_relation faction="faction.newrepublic"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.ascendancy"
									value="0.2" />
								<set_faction_relation faction="faction.ascendancy"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.sith"
									value="0.2" />
								<set_faction_relation faction="faction.sith"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.galempire"
									value="0.2" />
								<set_faction_relation faction="faction.galempire"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.sienar"
									value="0.2" />
								<set_faction_relation faction="faction.sienar"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.blacksun"
									value="-0.1" />
								<set_faction_relation faction="faction.blacksun"
									otherfaction="faction.thebankingclan"
									value="-0.1" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.valarian"
									value="-0.1" />
								<set_faction_relation faction="faction.valarian"
									otherfaction="faction.thebankingclan"
									value="-0.1" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.mandoraiders"
									value="-0.1" />
								<set_faction_relation faction="faction.mandoraiders"
									otherfaction="faction.thebankingclan"
									value="-0.1" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.huttpirates"
									value="-0.1" />
								<set_faction_relation faction="faction.huttpirates"
									otherfaction="faction.thebankingclan"
									value="-0.1" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.hapes"
									value="-0.1" />
								<set_faction_relation faction="faction.hapes"
									otherfaction="faction.thebankingclan"
									value="-0.1" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.transgalmeg"
									value="0.2" />
								<set_faction_relation faction="faction.transgalmeg"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.rendili"
									value="0.2" />
								<set_faction_relation faction="faction.rendili"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.naboo"
									value="0.2" />
								<set_faction_relation faction="faction.naboo"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.moncal"
									value="0.2" />
								<set_faction_relation faction="faction.moncal"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.kuat"
									value="0.2" />
								<set_faction_relation faction="faction.kuat"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.kamino"
									value="0.2" />
								<set_faction_relation faction="faction.kamino"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.incom"
									value="0.2" />
								<set_faction_relation faction="faction.incom"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.tagge"
									value="0.2" />
								<set_faction_relation faction="faction.tagge"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.tradefederation"
									value="0.2" />
								<set_faction_relation faction="faction.tradefederation"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.baobab"
									value="0.2" />
								<set_faction_relation faction="faction.baobab"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.twinsuns"
									value="0.2" />
								<set_faction_relation faction="faction.twinsuns"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.indibhg"
									value="0.2" />
								<set_faction_relation faction="faction.indibhg"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.corellia"
									value="0.2" />
								<set_faction_relation faction="faction.corellia"
									otherfaction="faction.thebankingclan"
									value="0.2" />
								<set_faction_relation faction="faction.thebankingclan"
									otherfaction="faction.hoersh"
									value="0.2" />
								<set_faction_relation faction="faction.hoersh"
									otherfaction="faction.thebankingclan"
									value="0.2" />

								<!-- Complete -->
								<set_value name="$SetupComplete" exact="true" />
								<reset_cue cue="InitSetup" />
							</actions>
						</cue>
					</cues>
				</cue>

				<cue name="BankingClan_Relation_Change">
					<conditions>
						<event_player_relation_changed />
						<check_value value="event.object == null and event.param != null" />
						<check_value value="$Accounts.keys.list.indexof.{event.param}" />
					</conditions>
					<actions>
						<set_value name="$faction" exact="event.param" />
						<set_value name="$account" exact="Accounts.{$faction}" />
						<set_value name="$newRelation" exact="$faction.relationto.{faction.player}" />
						<set_value name="$changeAmount" exact="event.param2.{1} - event.param2.{2}" />
						<set_value name="$change" exact="false" />
						<do_if value="$newRelation ge 1 and $Relation lt 1">
							<set_value name="$account.$fee" exact="$Fee30" />
							<set_value name="$account.$rate" exact="$Rate30" />
							<set_value name="$account.$period" exact="$Period30" />
							<set_value name="$change" exact="true" />
						</do_if>
						<do_elseif
							value="($newRelation ge 0.1 and $Relation lt 0.1) or ($newRelation lt 1 and $Relation ge 1)">
							<set_value name="$account.$fee" exact="$Fee20" />
							<set_value name="$account.$rate" exact="$Rate20" />
							<set_value name="$account.$period" exact="$Period20" />
							<set_value name="$change" exact="true" />
						</do_elseif>
						<do_elseif
							value="($newRelation ge 0.01 and $Relation lt 0.01) or ($newRelation lt 0.1 and $Relation ge 0.1)">
							<set_value name="$account.$fee" exact="$Fee10" />
							<set_value name="$account.$rate" exact="$Rate10" />
							<set_value name="$account.$period" exact="$Period10" />
							<set_value name="$change" exact="true" />
						</do_elseif>
						<do_elseif
							value="($newRelation ge 0 and $Relation lt 0) or ($newRelation lt 0.01 and $Relation ge 0.01)">
							<set_value name="$account.$fee" exact="$Fee0" />
							<set_value name="$account.$rate" exact="$Rate0" />
							<set_value name="$account.$period" exact="$Period0" />
							<set_value name="$change" exact="true" />
						</do_elseif>
						<do_elseif
							value="($newRelation gt -0.01 and $Relation le -0.01) or ($newRelation lt 0 and $Relation ge 0)">
							<set_value name="$account.$fee" exact="$Fee9" />
							<set_value name="$account.$rate" exact="$Rate9" />
							<set_value name="$account.$period" exact="$Period9" />
							<set_value name="$change" exact="true" />
							<do_if value="$newRelation gt -0.01 and $Relation le -0.01">
								<set_value name="$open" exact="true" />
							</do_if>
						</do_elseif>
						<do_elseif
							value="($newRelation le -0.01 and $Relation gt -0.01)">
							<set_value name="$account.$fee" exact="0" />
							<set_value name="$account.$rate" exact="0" />
							<set_value name="$account.$period" exact="0h" />
							<set_value name="$account.$balance" exact="0" />
							<set_value name="$change" exact="true" />
							<set_value name="$closed" exact="true" />
						</do_elseif>
						<set_value name="$Relation" exact="$newRelation" />
						<do_if value="$change and $account.$balance gt 0">
							<set_value name="$opening"
								exact="'This is a Priority Message from the InterGalactic Banking Clan.'" />
							<do_if value="$closed">
								<set_value name="$text"
									exact="'Your account has been closed.\n\nIn accordance with your account contract:\n\nArticle 1530.69201.56882\nClause 831\n\nYou assets held by the InterGalactic Banking Clan have been permanently forfeited.\n\nWe wish you well.'" />
								<remove_value name="$closed" />
							</do_if>
							<do_else>
								<set_value name="$data"
									exact="'Rate: '+$account.$rate*100+'%\nPeriod: '+$account.$period/3600+'hr\n\n'+{20777, 1006}+' Withdrawal Fee: '+$account.$Fee*100+'%'" />
								<do_if value="$changeAmount gt 0">
									<do_if value="$open">
										<set_value name="$statusText"
											exact="'We are proud to announce a once in a lifetime, hurry now before it is too late, very special, just for you, opportunity to open an account with us.\n\n'" />
									</do_if>
									<do_else>
										<set_value name="$statusText" exact="'Your account status has improved!\n\n'" />
									</do_else>
									<set_value name="$text"
										exact="$opening+'\n\n!! Congratulations !!\n\n'+$statusText+$data+'\n\nWe wish you well.'" />
								</do_if>
								<do_else>
									<set_value name="$text"
										exact="$opening+'\n\n!!! WARNING !!!\n\nWe regret to inform you that based on your recent actions, your account status has been reduced.\n\n'+$data+'\n\nWe wish you well.'" />
								</do_else>
								<remove_value name="$data" />
							</do_else>
							<write_incoming_message highpriority="true"
								source="'The InterGalactic Banking Clan'"
								title="'Account Status'"
								text="$text" />
							<show_help force="true" duration="8s"
								custom="'You have received a Priority Message from the Banking Clan'" position="20" />
							<show_notification
								text="'You have received a Priority Message from the Banking Clan'"
								timeout="8s" sound="ui_mon_eve_money_up" />
							<remove_value name="$change" />
							<remove_value name="$text" />
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>

				<!-- todo: the clone lab creates and cleans up office better -->
				<cue name="Bank_Remove" instantiate="true">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$object" exact="event.param.{1}" />
						<set_value name="$Interior" exact="event.param.{2}" />
						<do_if value="$Banker">
							<remove_actor_from_room actor="$Banker" />
							<destroy_object object="$Banker" />
						</do_if>
						<remove_dynamic_interior object="$object" interior="$Interior" />
						<destroy_object object="$Interior" />
						<remove_value name="$Interior" />
						<remove_value name="$Corridor" />
						<remove_value name="$Room" />
						<remove_value name="$Banker" />
					</actions>
				</cue>

				<cue name="Add_Office">
					<conditions>
						<event_object_changed_object object="player.entity" />
						<check_value value="player.station" />
					</conditions>
					<actions>
						<set_value name="$station" exact="player.station" />
						<do_if value="$MajorFactionList.{$station.sector.owner} or $Accounts.keys.list.indexof.{$station.owner}">
							<set_value name="$stationFaction" exact="$station.owner" />

							<!-- clean old office -->
							<do_if value="$StationInterior">
								<signal_cue_instantly cue="Bank_Remove" param="[$StationTable, $StationInterior]" />
							</do_if>

							<!-- vault office -->
							<do_if value="$stationFaction == faction.thebankingclan">
								<set_value name="$faction" exact="faction.thebankingclan" />
								<set_value name="$officeName" exact="'{20777, 1001} {20777, 1005} - {20777, 1004} {20777, 1007} '" />
							</do_if>
							<!-- branch office -->
							<do_elseif value="not $Accounts.keys.list.indexof.{$stationFaction}">
								<set_value name="$faction" exact="faction.thebankingclan" />
								<set_value name="$officeName" exact="'{20777, 1001} {20777, 1005} - {20777, 1006} {20777, 1007} '" />
							</do_elseif>
							<!-- use station manager -->
							<do_else>
								<set_value name="$faction" exact="$stationFaction" />
							</do_else>

							<!-- setup office -->
							<do_if value="@$officeName">
								<create_cue_actor name="$Banker" cue="this">
									<select faction="faction.thebankingclan" />
									<owner exact="faction.thebankingclan" />
								</create_cue_actor>
								<set_entity_traits entity="$Banker" missionactor="true" />
								<set_entity_overrides entity="$Banker" icon="'specialist'" />
								<get_room_definition macro="$CorridorMacro" race="$station.owner.primaryrace"
									tags="tag.corridor" />
								<do_if value="not $CorridorMacro">
									<get_room_definition macro="$CorridorMacro" race="faction.argon.primaryrace"
										tags="tag.corridor" />
								</do_if>
								<get_room_definition macro="$roomMacro" race="faction.argon.primaryrace"
									tags="tag.office" />
								<create_dynamic_interior object="$station"
									corridor="$CorridorMacro" room="$roomMacro"
									name="$officeName"
									interiorname="$Interior" corridorname="$Corridor" roomname="$Room"
									roomtype="roomtype.office"
									seed="$station.seed + lookup.roomtype.list.indexof.{roomtype.office}" />
								<do_if value="$Interior and $Corridor and $Room">
									<find_npc_slot name="$roomSlot" object="$Room" tags="tag.control" />
									<do_if value="$roomSlot">
										<add_actor_to_room actor="$Banker" slot="$roomSlot" />
									</do_if>
								</do_if>
								<set_value name="$StationTable" exact="$station" />
								<set_value name="$StationInterior" exact="$Interior" />
								<set_value name="$Interior" exact="null" />
							</do_if>
						</do_if>
					</actions>
					<cues>
						<cue name="BankerConversationStart">
							<conditions>
								<check_any>
									<event_cue_signalled />
									<event_conversation_started conversation="default" />
								</check_any>
								<check_any>
									<check_value value="event.object == player.container.tradenpc?" />
									<check_value value="event.object == $Banker?" />
								</check_any>
							</conditions>
							<actions>
								<set_value name="$Banker" exact="event.object" />
								<do_if value="event.name == 'event_cue_signalled'">
									<set_value name="$convoOption_Banker_Account"
										exact="@event.param.$convoOption_Banker_Account" />
								</do_if>
								<do_else>
									<set_value name="$convoOption_Banker_Account" exact="true" />
								</do_else>
								<do_if
									value="event.name == 'event_conversation_started' and @md.ExtendedConversationMenu.Main.exists">
									<set_value name="md.ExtendedConversationMenu.Main.$convOptions.$Banker"
										exact="table[
										$signalCue = BankerConversationStart,
										$params = table[$convoOption_Banker_Account = @$convoOption_Banker_Account]
									]" />
								</do_if>
								<do_else>
									<do_if value="$convoOption_Banker_Account">
										<add_player_choice text="'Access Account'" section="Banker_Account" />
									</do_if>
								</do_else>
								<reset_cue cue="this" />
							</actions>
						</cue>
						<cue name="BankerConversationNext">
							<conditions>
								<event_conversation_next_section sectionprefix="Banker_" />
							</conditions>
							<actions>
								<do_if value="event.param == 'Banker_Account'">
									<signal_cue_instantly cue="Bank_Menu_Open" />
								</do_if>
								<reset_cue cue="this" />
							</actions>
						</cue>
					</cues>
				</cue>

				<!-- ui account access interaction button -->
				<cue name="Vault_AccountMenu">
					<conditions>
						<event_cue_signalled cue="md.Interact_Menu_API.Get_Actions" />
						<check_value value="@event.param.$object.sector == player.sector" />
						<check_value value="@event.param.$object.isclass.{class.station}" />
						<check_value value="$Accounts.keys.list.indexof.{@event.param.$object.owner} or $MajorFactionList.{@event.param.$object.sector.owner}" />
						<check_value value="@event.param.$object.owner.relationto.{faction.player} gt -0.01" />
						<check_value value="@event.param.$object.distanceto.{player.entity} le 10km" />
					</conditions>
					<actions>
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param="table[
							$id = 'Vault_AccountMenu',
							$section = 'main',
							$text = 'Access Account',
							$icon = 'menu_swi_credits',
							$callback = Bank_Menu,
							$echo = table[$faction = event.param.$object.owner]
						]" />
						<reset_cue cue="this" />
					</actions>
				</cue>

				<cue name="Bank_Menu" instantiate="true">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<delay exact="1ms" />
					<actions>
						<!-- undocked -->
						<do_if value="event.param.$echo.$faction?">
							<set_value name="$Faction" exact="event.param.$echo.$faction" />
						</do_if>
						<!-- docked -->
						<do_else>
							<set_value name="$Faction" exact="event.object.trueowner" />
						</do_else>
						<!-- determine account -->
						<do_if value="$Faction == faction.thebankingclan">
							<set_value name="$Title" exact="'InterGalactic Bank Account'" />
						</do_if>
						<do_elseif value="$Accounts.keys.list.indexof.{$Faction}">
							<set_value name="$Title" exact="$Faction+': Account'" />
						</do_elseif>
						<do_else>
							<set_value name="$Faction" exact="faction.thebankingclan" />
							<set_value name="$Title" exact="'InterGalactic Bank Account'" />
						</do_else>
						<set_value name="$account" exact="$Accounts.{$Faction}" />
						<!-- set cue variablse -->
						<set_value name="$Fee" exact="$account.$fee + $account.$undockedFee" />
						<set_value name="$Rate" exact="$account.$rate" />
						<set_value name="$Period" exact="$account.$period" />
						<!-- update interest -->
						<set_value name="$timeSinceInterest" exact="player.age - $account.$interest_time" />
						<do_if value="$timeSinceInterest> 1">
							<set_value name="$newBalance" exact="$account.$balance * ((1 + $Rate)^($timeSinceInterest / $Period))" />
							<set_value name="$Interest_amount" exact="$newBalance - $account.$balance" />
							<set_value name="$Accounts.{$Faction}.$balance" exact="$account.$balance + $interest_amount" />
							<set_value name="$Withdraw_amount" exact="0" />
							<set_value name="$newBalance" exact="$account.$balance" />
							<set_value name="$Accounts.{$Faction}.$interest_time" exact="player.age" />
						</do_if>
						<signal_cue cue="Bank_Menu_Open" />
					</actions>
					<cues>

						<cue name="Bank_Menu_Open" instantiate="true">
							<conditions>
								<event_cue_signalled />
							</conditions>
							<actions>
								<set_value name="$account" exact="$Accounts.{$Faction}" />
								<set_value name="$Deposit_amount" exact="0" />
								<set_value name="$Withdraw_amount" exact="0" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Create_Menu"
									param="table[
									$id = 'bank_menu',
									$columns = 1,
									$title = $Title,
									$height = 400,
									$width = 300
								]" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Add_Row" param="table[$interactive=false]" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Make_Text"
									param="table[$col=1, $halign='center', $text='Status']" />
								<do_if value="$Fee gt 0">
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row" param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $halign='center', $color='Helper.color.red', $text='('+{20777, 1006}+' Fee: '+ $Fee*100 + '%)']" />
								</do_if>
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
									param="table[$interactive=false]" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
									param="table[$col=1, $text='']" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Add_Row" param="table[$interactive=false]" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Make_Text" param="table[
											$col=1, $halign='center',
											$text=$Rate * 100 + '% interest per ' + $Period / 60 / 60 + ' hours.']" />
								<do_if value="$account.$balance gt 0">
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $text='']" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $halign='right', $text='Interest earned since last update:']" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $halign='right', $text=$Interest_amount+'Cr']" />
								</do_if>
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
									param="table[$interactive=false]" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
									param="table[$col=1, $text='']" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
									$start = 0,
									$col = 1,
									$text = table[$text=''],
									$min = 0, $max = player.money, $step = 1, $suffix='Cr',
									$default = 0,
									$onSliderCellChanged = Bank_Menu_Deposit_Amount
								]" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
									$col = 1,
									$text = table[$text='Deposit'],
									$onClick = Bank_Menu_Deposit
								]" />
								<do_if value="$account.$balance gt 0">
									<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $text='']" />
									<do_if value="$Fee gt 0">
										<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
											param="table[$interactive=false]" />
										<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
											param="table[$col=1, $halign='right', $text='Max withdrawal after '+{20777, 1006}+' Fee:']" />
									</do_if>
									<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
										$start = 0,
										$col = 1,
										$text = table[$text=''],
										$min = 0, $max = $account.$balance / (1+$Fee), $step = 1, $suffix='Cr',
										$default = 0,
										$onSliderCellChanged = Bank_Menu_Withdraw_Amount
									]" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
										$col = 1,
										$text = table[$text='Withdraw'],
										$onClick = Bank_Menu_Withdraw
									]" />
								</do_if>
							</actions>
							<cues>
								<!-- sliders -->
								<cue name="Bank_Menu_Deposit_Amount" instantiate="true">
									<conditions>
										<event_cue_signalled />
									</conditions>
									<actions>
										<set_value name="$Deposit_amount" exact="event.param.$value" />
										<cancel_cue cue="this" />
									</actions>
								</cue>
								<cue name="Bank_Menu_Withdraw_Amount" instantiate="true">
									<conditions>
										<event_cue_signalled />
									</conditions>
									<actions>
										<set_value name="$Withdraw_amount" exact="event.param.$value" />
										<cancel_cue cue="this" />
									</actions>
								</cue>

								<!-- actions -->
								<cue name="Bank_Menu_Deposit" instantiate="true">
									<conditions>
										<event_cue_signalled />
									</conditions>
									<actions>
										<set_value name="$account" exact="$Accounts.{$Faction}" />
										<do_if value="player.money ge $Deposit_amount">
											<do_if value="$account.$balance == 0">
												<set_value name="$Accounts.{$Faction}.$interest_time" exact="player.age" />
											</do_if>
											<do_else>
												<set_value name="$timeSinceInterest" exact="player.age - $account.$interest_time" />
												<set_value name="$Accounts.{$Faction}.$interest_time" exact="player.age" />
												<set_value name="$Interest_amount" exact="$account.$balance * ((1 + $Rate)^($timeSinceInterest / $Period) - 1)" />
											</do_else>
											<reward_player money="($Deposit_amount)Cr * -1" />
											<set_value name="$Accounts.{$Faction}.$balance" operation="add" exact="$Deposit_amount + $Interest_amount" />
											<signal_cue_instantly cue="md.Simple_Menu_API.Close_Menu" />
											<signal_cue_instantly cue="Bank_Menu_Open" />
										</do_if>
										<do_else>
											<cancel_cue cue="this" />
										</do_else>
									</actions>
								</cue>
								<cue name="Bank_Menu_Withdraw" instantiate="true">
									<conditions>
										<event_cue_signalled />
									</conditions>
									<actions>
										<set_value name="$account" exact="$Accounts.{$Faction}" />
										<do_if value="$account.$balance ge $Withdraw_amount">
											<set_value name="$timeSinceInterest" exact="player.age - $account.$interest_time" />
											<set_value name="$Accounts.{$Faction}.$interest_time" exact="player.age" />
											<set_value name="$Interest_amount" exact="$account.$balance * ((1 + $Rate)^($timeSinceInterest / $Period) - 1)" />
											<do_if value="$account.$balance - $Withdraw_amount * (1+$Fee) lt 1">
												<reward_player money="($Withdraw_amount * 100)ct + $Interest_amount" />
												<set_value name="$Accounts.{$Faction}.$balance" exact="0" />
											</do_if>
											<do_else>
												<reward_player money="($Withdraw_amount)Cr" />
												<set_value name="$Accounts.{$Faction}.$balance" operation="add" exact="$Interest_amount - $Withdraw_amount * (1+$Fee)" />
											</do_else>
											<signal_cue_instantly cue="md.Simple_Menu_API.Close_Menu" />
											<signal_cue_instantly cue="Bank_Menu_Open" />
										</do_if>
										<do_else>
											<cancel_cue cue="this" />
										</do_else>
									</actions>
								</cue>
							</cues>
						</cue>
					</cues>
				</cue>

				<!-- api -->
				<!-- param: table[$faction = $faction, $money = $money] -->
				<!-- positive money is deposit, negative is withdrawal -->
				<cue name="Transfer">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$faction" exact="event.param.$faction" />
						<do_if value="$faction.hastag.{tag.economic}">
							<do_if value="not $Accounts.keys.list.indexof.{$faction}">
								<set_value name="$faction" exact="faction.thebankingclan" />
							</do_if>
							<set_value name="$account" exact="$Accounts.{$faction}" />
							<do_if value="$account.$balance == 0">
								<set_value name="$Accounts.{$faction}.$interest_time" exact="player.age" />
							</do_if>
							<do_else>
								<set_value name="$timeSinceInterest" exact="player.age - $account.$interest_time" />
								<set_value name="$Accounts.{$faction}.$interest_time" exact="player.age" />
								<set_value name="$interest_amount" exact="$account.$balance * ((1 + $account.$rate)^($timeSinceInterest / $account.$period) - 1)" />
								<set_value name="$Accounts.{$faction}.$balance" operation="add" exact="$interest_amount" />
							</do_else>
							<set_value name="$Accounts.{$faction}.$balance" operation="add" exact="event.param.$money" />
						</do_if>
						<!-- catch all for civilian, criminal, smuggler, etc factions -->
						<do_else>
							<reward_player money="event.param.$money" />
						</do_else>
						<reset_cue cue="this" />
					</actions>
				</cue>

				<!-- ui open lootbox interaction button -->
				<cue name="Vault_LootboxMenu">
					<conditions>
						<event_cue_signalled cue="md.Interact_Menu_API.Get_Actions" />
						<check_value value="@event.param.$object.sector == player.sector" />
						<check_value value="@event.param.$object.isclass.{class.station}" />
						<check_value value="$Accounts.keys.list.indexof.{@event.param.$object.owner} or $MajorFactionList.{@event.param.$object.sector.owner}" />
						<check_value value="@event.param.$object.owner.relationto.{faction.player} gt -0.01" />
						<check_value value="@event.param.$object.distanceto.{player.entity} le 10km" />
					</conditions>
					<actions>
						<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param="table[
							$id = 'Vault_LootboxMenu',
							$section = 'main',
							$text = 'Open Lootbox',
							$icon = 'menu_swi_credits',
							$callback = Lootbox_Menu,
							$echo = table[$faction = event.param.$object.owner]
						]" />
						<reset_cue cue="this" />
					</actions>
				</cue>

				<cue name="Lootbox_Menu" instantiate="true">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<delay exact="1ms" />
					<actions>
						<!-- undocked -->
						<do_if value="event.param.$echo.$faction?">
							<set_value name="$Faction" exact="event.param.$echo.$faction" />
						</do_if>
						<!-- docked -->
						<do_else>
							<set_value name="$Faction" exact="event.object.trueowner" />
						</do_else>
						<!-- determine account -->
						<do_if value="$Faction == faction.thebankingclan">
							<set_value name="$Title" exact="'InterGalactic Bank Account'" />
						</do_if>
						<do_elseif value="$Accounts.keys.list.indexof.{$Faction}">
							<set_value name="$Title" exact="$Faction+': Account'" />
						</do_elseif>
						<do_else>
							<set_value name="$Faction" exact="faction.thebankingclan" />
							<set_value name="$Title" exact="'InterGalactic Bank Account'" />
						</do_else>
						<set_value name="$account" exact="$Accounts.{$Faction}" />
						<!-- set cue variablse -->
						<set_value name="$Fee" exact="$account.$fee + $account.$undockedFee" />
						<set_value name="$Rate" exact="$account.$rate" />
						<set_value name="$Period" exact="$account.$period" />
						<!-- update interest -->
						<set_value name="$timeSinceInterest" exact="player.age - $account.$interest_time" />
						<do_if value="$timeSinceInterest> 1">
							<set_value name="$newBalance" exact="$account.$balance * ((1 + $Rate)^($timeSinceInterest / $Period))" />
							<set_value name="$Interest_amount" exact="$newBalance - $account.$balance" />
							<set_value name="$Accounts.{$Faction}.$balance" exact="$account.$balance + $interest_amount" />
							<set_value name="$Withdraw_amount" exact="0" />
							<set_value name="$newBalance" exact="$account.$balance" />
							<set_value name="$Accounts.{$Faction}.$interest_time" exact="player.age" />
						</do_if>
						<signal_cue cue="Lootbox_Menu_Open" />
					</actions>
					<cues>

						<cue name="Lootbox_Menu_Open" instantiate="true">
							<conditions>
								<event_cue_signalled />
							</conditions>
							<actions>
								<set_value name="$account" exact="$Accounts.{$Faction}" />
								<set_value name="$Deposit_amount" exact="0" />
								<set_value name="$Withdraw_amount" exact="0" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Create_Menu"
									param="table[
									$id = 'Lootbox_Menu',
									$columns = 1,
									$title = $Title,
									$height = 400,
									$width = 300
								]" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Add_Row" param="table[$interactive=false]" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Make_Text"
									param="table[$col=1, $halign='center', $text='Status']" />
								<do_if value="$Fee gt 0">
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row" param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $halign='center', $color='Helper.color.red', $text='('+{20777, 1006}+' Fee: '+ $Fee*100 + '%)']" />
								</do_if>
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
									param="table[$interactive=false]" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
									param="table[$col=1, $text='']" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Add_Row" param="table[$interactive=false]" />
								<signal_cue_instantly
									cue="md.Simple_Menu_API.Make_Text" param="table[
											$col=1, $halign='center',
											$text=$Rate * 100 + '% interest per ' + $Period / 60 / 60 + ' hours.']" />
								<do_if value="$account.$balance gt 0">
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $text='']" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $halign='right', $text='Interest earned since last update:']" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly
										cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $halign='right', $text=$Interest_amount+'Cr']" />
								</do_if>
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
									param="table[$interactive=false]" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
									param="table[$col=1, $text='']" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
									$start = 0,
									$col = 1,
									$text = table[$text=''],
									$min = 0, $max = player.money, $step = 1, $suffix='Cr',
									$default = 0,
									$onSliderCellChanged = Bank_Menu_Deposit_Amount
								]" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
								<signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
									$col = 1,
									$text = table[$text='Deposit'],
									$onClick = Bank_Menu_Deposit
								]" />
								<do_if value="$account.$balance gt 0">
									<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
										param="table[$interactive=false]" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
										param="table[$col=1, $text='']" />
									<do_if value="$Fee gt 0">
										<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"
											param="table[$interactive=false]" />
										<signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
											param="table[$col=1, $halign='right', $text='Max withdrawal after '+{20777, 1006}+' Fee:']" />
									</do_if>
									<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
										$start = 0,
										$col = 1,
										$text = table[$text=''],
										$min = 0, $max = $account.$balance / (1+$Fee), $step = 1, $suffix='Cr',
										$default = 0,
										$onSliderCellChanged = Bank_Menu_Withdraw_Amount
									]" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
									<signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
										$col = 1,
										$text = table[$text='Withdraw'],
										$onClick = Bank_Menu_Withdraw
									]" />
								</do_if>
							</actions>
							<cues>
								<!-- checkbox -->
								<cue name="UseSecurityOverrideCheckbox" instantiate="true">
									<conditions>
										<event_cue_signalled />
									</conditions>
									<actions>
										<set_value name="$UseSecurityOverride" exact="event.param.$value" />
										<cancel_cue cue="this" />
									</actions>
								</cue>

								<!-- actions -->
								<cue name="OpenLootbox" instantiate="true">
									<conditions>
										<event_cue_signalled />
									</conditions>
									<actions>
										<set_value name="$account" exact="$Accounts.{$Faction}" />
										<do_if value="player.money ge $Deposit_amount">
											<do_if value="$account.$balance == 0">
												<set_value name="$Accounts.{$Faction}.$interest_time" exact="player.age" />
											</do_if>
											<do_else>
												<set_value name="$timeSinceInterest" exact="player.age - $account.$interest_time" />
												<set_value name="$Accounts.{$Faction}.$interest_time" exact="player.age" />
												<set_value name="$Interest_amount" exact="$account.$balance * ((1 + $Rate)^($timeSinceInterest / $Period) - 1)" />
											</do_else>
											<reward_player money="($Deposit_amount)Cr * -1" />
											<set_value name="$Accounts.{$Faction}.$balance" operation="add" exact="$Deposit_amount + $Interest_amount" />
											<signal_cue_instantly cue="md.Simple_Menu_API.Close_Menu" />
											<signal_cue_instantly cue="Bank_Menu_Open" />
										</do_if>
										<do_else>
											<cancel_cue cue="this" />
										</do_else>
									</actions>
								</cue>
							</cues>
						</cue>
					</cues>
				</cue>

				<!-- unused -->
				<cue name="SpawnLargeLootBox">
					<conditions>
						<check_any>
							<event_cue_signalled />
							<!--check for destroyed vault component-->
						</check_any>
					</conditions>
					<delay exact="2s" />
					<actions>
						<do_all exact="[2,4,6].random">
							<set_value name="$RandomMultiplier" exact="[1.4, 1.5, 1.6, 1.8, 1.9, 2.0, 2.1, 2.2, 2.4, 2.6].random" />
							<do_any>
								<do_all>
									<create_position name="$TargetOffset" space="event.object.sector" object="event.object" />
									<set_value name="$TargetVelocityX" exact="-200 * $RandomMultiplier" />
									<set_value name="$TargetVelocityY" exact="0" />
									<set_value name="$TargetVelocityZ" exact="0" />
								</do_all>
								<do_all>
									<create_position name="$TargetOffset" space="event.object.sector" object="event.object" />
									<set_value name="$TargetVelocityX" exact="-200 * $RandomMultiplier" />
									<set_value name="$TargetVelocityY" exact="0" />
									<set_value name="$TargetVelocityZ" exact="-200 * $RandomMultiplier" />
								</do_all>
								<do_all>
									<create_position name="$TargetOffset" space="event.object.sector" object="event.object" />
									<set_value name="$TargetVelocityX" exact="200 * $RandomMultiplier" />
									<set_value name="$TargetVelocityY" exact="0" />
									<set_value name="$TargetVelocityZ" exact="0" />
								</do_all>
							</do_any>
							<set_value name="$Pitch" min="0" max="360" />
							<set_value name="$Yaw" min="0" max="360" />
							<set_value name="$Roll" min="0" max="360" />
							<create_object name="$lootbox" sector="event.object.sector" macro="macro.bank_wares_macro">
								<position value="$TargetOffset" />
								<rotation pitch="($Pitch)deg" yaw="($Yaw)deg" roll="($Roll)deg" />
							</create_object>
							<add_object_velocity object="$lootbox">
								<linear x="$TargetVelocityX" y="$TargetVelocityY" z="$TargetVelocityZ" />
							</add_object_velocity>
							<add_cargo object="$lootbox" ware="ware.bank_large_credit_lootbox" exact="[1,2,3].random" />
						</do_all>
						<reset_cue cue="this" />
					</actions>
				</cue>
			</cues>
		</cue>
	</cues>
</mdscript>